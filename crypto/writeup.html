<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        SECCON CTF 2022 Writeup (crypto) - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{background-color:#f7f7f7;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-inner comment-enabled" data-hard-breaks="true"><h6 id="tags-writeup" data-id="tags-writeup"><a class="anchor hidden-xs" href="#tags-writeup" title="tags-writeup"><span class="octicon octicon-link"></span></a><span>tags: </span><code>writeup</code></h6><h1 id="SECCON-CTF-2022-Writeup-crypto" data-id="SECCON-CTF-2022-Writeup-crypto"><a class="anchor hidden-xs" href="#SECCON-CTF-2022-Writeup-crypto" title="SECCON-CTF-2022-Writeup-crypto"><span class="octicon octicon-link"></span></a><span>SECCON CTF 2022 Writeup (crypto)</span></h1><p><span>Author: </span><a href="https://twitter.com/ta1yak1_8926" target="_blank" rel="noopener"><span>ta1yak1_8926</span></a></p><p><span>See also the following, since the formulas do not display well in HTML format.</span></p><p><a href="https://hackmd.io/oNAOHWigSXGV_4pd1_lqOA" target="_blank" rel="noopener"><span>https://hackmd.io/oNAOHWigSXGV_4pd1_lqOA</span></a></p><p><span>Here are my writeup to all the crypto challenges except “janken vs kurenaif”.</span></p><p><span>Notions:</span></p><ul>
<li><span>Upper-case letters: known</span></li>
<li><span>Lower-case letters: unknown</span></li>
</ul><h2 id="pqpq-96-pts-112-solved" data-id="pqpq-96-pts-112-solved"><a class="anchor hidden-xs" href="#pqpq-96-pts-112-solved" title="pqpq-96-pts-112-solved"><span class="octicon octicon-link"></span></a><span>pqpq (96 pts, 112 solved)</span></h2><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag

p = getPrime(<span class="hljs-number">512</span>)
q = getPrime(<span class="hljs-number">512</span>)
r = getPrime(<span class="hljs-number">512</span>)
n = p * q * r
e = <span class="hljs-number">2</span> * <span class="hljs-number">65537</span>

<span class="hljs-keyword">assert</span> n.bit_length() // <span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(flag) &gt; <span class="hljs-number">0</span>
padding = get_random_bytes(n.bit_length() // <span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(flag))
m = bytes_to_long(padding + flag)

<span class="hljs-keyword">assert</span> m &lt; n

c1p = <span class="hljs-built_in">pow</span>(p, e, n)
c1q = <span class="hljs-built_in">pow</span>(q, e, n)
cm = <span class="hljs-built_in">pow</span>(m, e, n)
c1 = (c1p - c1q) % n
c2 = <span class="hljs-built_in">pow</span>(p - q, e, n)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"e = <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"n = <span class="hljs-subst">{n}</span>"</span>)
<span class="hljs-comment"># p^e - q^e mod n</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"c1 = <span class="hljs-subst">{c1}</span>"</span>)
<span class="hljs-comment"># (p-q)^e mod n</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"c2 = <span class="hljs-subst">{c2}</span>"</span>)
<span class="hljs-comment"># m^e mod n</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"cm = <span class="hljs-subst">{cm}</span>"</span>)
</div></div></code></pre><h3 id="Overview" data-id="Overview"><a class="anchor hidden-xs" href="#Overview" title="Overview"><span class="octicon octicon-link"></span></a><span>Overview</span></h3><ul>
<li><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-279-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>E</mi><mo>=</mo><mn>2</mn><mo>&amp;#x22C5;</mo><mn>65537</mn></math>" role="presentation"><span id="MJXc-Node-3146" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-3147" class="mjx-mrow"><span id="MJXc-Node-3148" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.026em;">E</span></span><span id="MJXc-Node-3149" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.058em; padding-bottom: 0.335em;">=</span></span><span id="MJXc-Node-3150" class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.335em;">2</span></span><span id="MJXc-Node-3151" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.003em; padding-bottom: 0.335em;">⋅</span></span><span id="MJXc-Node-3152" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.39em;">65537</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>E</mi><mo>=</mo><mn>2</mn><mo>⋅</mo><mn>65537</mn></math></span></span><script type="math/tex" id="MathJax-Element-279">E = 2 \cdot 65537</script></span></li>
<li><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-280-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi><mo>=</mo><mi>p</mi><mi>q</mi><mi>r</mi></math>" role="presentation"><span id="MJXc-Node-3153" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-3154" class="mjx-mrow"><span id="MJXc-Node-3155" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.085em;">N</span></span><span id="MJXc-Node-3156" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.058em; padding-bottom: 0.335em;">=</span></span><span id="MJXc-Node-3157" class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.445em;">p</span></span><span id="MJXc-Node-3158" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.445em; padding-right: 0.014em;">q</span></span><span id="MJXc-Node-3159" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.279em;">r</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mo>=</mo><mi>p</mi><mi>q</mi><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-280">N = pqr</script></span></li>
<li><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-281-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mn>1</mn></msub><mo>&amp;#x2261;</mo><msup><mi>p</mi><mi>E</mi></msup><mo>&amp;#x2212;</mo><msup><mi>q</mi><mi>E</mi></msup><mo lspace=&quot;thickmathspace&quot; rspace=&quot;thickmathspace&quot;>mod</mo><mi>N</mi></math>" role="presentation"><span id="MJXc-Node-3160" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-3161" class="mjx-mrow"><span id="MJXc-Node-3162" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.045em;"><span id="MJXc-Node-3163" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.501em; padding-bottom: 0.279em; padding-right: 0.045em;">C</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-3164" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.335em;">1</span></span></span></span><span id="MJXc-Node-3165" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.169em; padding-bottom: 0.335em;">≡</span></span><span id="MJXc-Node-3166" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-3167" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.445em;">p</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-3168" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.026em;">E</span></span></span></span><span id="MJXc-Node-3169" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.279em; padding-bottom: 0.445em;">−</span></span><span id="MJXc-Node-3170" class="mjx-msubsup MJXc-space2"><span class="mjx-base" style="margin-right: -0.014em;"><span id="MJXc-Node-3171" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.445em; padding-right: 0.014em;">q</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0.096em; padding-right: 0.071em;"><span id="MJXc-Node-3172" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.026em;">E</span></span></span></span><span id="MJXc-Node-3173" class="mjx-mo" style="padding-left: 0.278em; padding-right: 0.278em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.335em;">mod</span></span><span id="MJXc-Node-3174" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.085em;">N</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>C</mi><mn>1</mn></msub><mo>≡</mo><msup><mi>p</mi><mi>E</mi></msup><mo>−</mo><msup><mi>q</mi><mi>E</mi></msup><mo lspace="thickmathspace" rspace="thickmathspace">mod</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-281">C_1 \equiv p^E - q^E \bmod N</script></span></li>
<li><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-282-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>C</mi><mn>2</mn></msub><mo>&amp;#x2261;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>&amp;#x2212;</mo><mi>q</mi><msup><mo stretchy=&quot;false&quot;>)</mo><mi>E</mi></msup><mo lspace=&quot;thickmathspace&quot; rspace=&quot;thickmathspace&quot;>mod</mo><mi>N</mi></math>" role="presentation"><span id="MJXc-Node-3175" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-3176" class="mjx-mrow"><span id="MJXc-Node-3177" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.045em;"><span id="MJXc-Node-3178" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.501em; padding-bottom: 0.279em; padding-right: 0.045em;">C</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-3179" class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.335em;">2</span></span></span></span><span id="MJXc-Node-3180" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.169em; padding-bottom: 0.335em;">≡</span></span><span id="MJXc-Node-3181" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.445em; padding-bottom: 0.611em;">(</span></span><span id="MJXc-Node-3182" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.445em;">p</span></span><span id="MJXc-Node-3183" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.279em; padding-bottom: 0.445em;">−</span></span><span id="MJXc-Node-3184" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.445em; padding-right: 0.014em;">q</span></span><span id="MJXc-Node-3185" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-3186" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.445em; padding-bottom: 0.611em;">)</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-3187" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.026em;">E</span></span></span></span><span id="MJXc-Node-3188" class="mjx-mo" style="padding-left: 0.278em; padding-right: 0.278em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.335em;">mod</span></span><span id="MJXc-Node-3189" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.085em;">N</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>C</mi><mn>2</mn></msub><mo>≡</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mi>q</mi><msup><mo stretchy="false">)</mo><mi>E</mi></msup><mo lspace="thickmathspace" rspace="thickmathspace">mod</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-282">C_2 \equiv (p - q)^E \bmod N</script></span></li>
<li><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-283-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mo>&amp;#x2261;</mo><msup><mi>m</mi><mi>E</mi></msup><mo lspace=&quot;thickmathspace&quot; rspace=&quot;thickmathspace&quot;>mod</mo><mi>N</mi></math>" role="presentation"><span id="MJXc-Node-3190" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-3191" class="mjx-mrow"><span id="MJXc-Node-3192" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.501em; padding-bottom: 0.279em; padding-right: 0.045em;">C</span></span><span id="MJXc-Node-3193" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.169em; padding-bottom: 0.335em;">≡</span></span><span id="MJXc-Node-3194" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-3195" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.279em;">m</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-3196" class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.026em;">E</span></span></span></span><span id="MJXc-Node-3197" class="mjx-mo" style="padding-left: 0.278em; padding-right: 0.278em;"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.39em; padding-bottom: 0.335em;">mod</span></span><span id="MJXc-Node-3198" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.445em; padding-bottom: 0.279em; padding-right: 0.085em;">N</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mo>≡</mo><msup><mi>m</mi><mi>E</mi></msup><mo lspace="thickmathspace" rspace="thickmathspace">mod</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-283">C \equiv m^E \bmod N</script></span></li>
</ul><p><span>The challenge is to find </span><span class="mathjax"><span class="MathJax_Preview" style="color: inherit;"></span><span id="MathJax-Element-284-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" style="font-size: 113%; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>m</mi></math>" role="presentation"><span id="MJXc-Node-3199" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-3200" class="mjx-mrow"><span id="MJXc-Node-3201" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.224em; padding-bottom: 0.279em;">m</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>m</mi></math></span></span><script type="math/tex" id="MathJax-Element-284">m</script></span><span> under the above conditions.</span></p><h3 id="Prime-Factorization" data-id="Prime-Factorization"><a class="anchor hidden-xs" href="#Prime-Factorization" title="Prime-Factorization"><span class="octicon octicon-link"></span></a><span>Prime Factorization</span></h3><p><span>Since there is not much information on </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2771"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2772">r</span></span></span><script type="math/tex" id="MathJax-Element-285">r</script></span><span>, first ignore </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2773"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2774">r</span></span></span><script type="math/tex" id="MathJax-Element-286">r</script></span><span> and consider </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2775"><span class="MJXp-mo" id="MJXp-Span-2776" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2777">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2778">q</span></span></span><script type="math/tex" id="MathJax-Element-287">\bmod pq</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2779"><span class="MJXp-msubsup" id="MJXp-Span-2780"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2781" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2782" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2783" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-2784"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2785" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2786" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2787" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2788"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2789" style="margin-right: 0.05em;">q</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2790" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2791" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2792">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2793">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-288">C_1 \equiv p^E - q^E \bmod pq</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2794"><span class="MJXp-msubsup" id="MJXp-Span-2795"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2796" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2797" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2798" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mo" id="MJXp-Span-2799" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2800">p</span><span class="MJXp-mo" id="MJXp-Span-2801" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2802">q</span><span class="MJXp-msubsup" id="MJXp-Span-2803"><span class="MJXp-mo" id="MJXp-Span-2804" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2805" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2806" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2807">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2808">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-289">C_2 \equiv (p - q)^E \bmod pq</script></span></p><p><span>Perform a binomial expansion on the right-hand side of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2809"><span class="MJXp-msubsup" id="MJXp-Span-2810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2811" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2812" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-290">C_2</script></span><span>.</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2813"><span class="MJXp-msubsup" id="MJXp-Span-2814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2815" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2816" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2817" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-2818"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2819" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2820" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2821" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2822">E</span><span class="MJXp-mo" id="MJXp-Span-2823" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-2824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2825" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2826" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2827">E</span><span class="MJXp-mo" id="MJXp-Span-2828">−</span><span class="MJXp-mn" id="MJXp-Span-2829">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2830" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-2831" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2832" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2833">q</span><span class="MJXp-msubsup" id="MJXp-Span-2834"><span class="MJXp-mo" id="MJXp-Span-2835" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2836" style="vertical-align: 0.5em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2837" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2838" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-2839" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2840">E</span><span class="MJXp-msubsup" id="MJXp-Span-2841"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2842" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2843" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-2844">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2845" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-2846" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2847" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2848">q</span><span class="MJXp-msubsup" id="MJXp-Span-2849"><span class="MJXp-mo" id="MJXp-Span-2850" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2851" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2852">E</span><span class="MJXp-mo" id="MJXp-Span-2853">−</span><span class="MJXp-mn" id="MJXp-Span-2854">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2855" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2856" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2857" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2858">q</span><span class="MJXp-msubsup" id="MJXp-Span-2859"><span class="MJXp-mo" id="MJXp-Span-2860" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2861" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2862" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2863">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2864">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-291">C_2 \equiv p^E + E\cdot p^{E-1}\cdot(-q)^1 + \cdots + Ep^{1}\cdot(-q)^{E-1} + (-q)^E \bmod pq</script></span></p><p><span>The terms </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2866">E</span><span class="MJXp-mo" id="MJXp-Span-2867" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-2868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2869" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2870" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2871">E</span><span class="MJXp-mo" id="MJXp-Span-2872">−</span><span class="MJXp-mn" id="MJXp-Span-2873">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2874" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-2875" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2876" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2877">q</span><span class="MJXp-msubsup" id="MJXp-Span-2878"><span class="MJXp-mo" id="MJXp-Span-2879" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2880" style="vertical-align: 0.5em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2881" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2882" style="margin-left: 0em; margin-right: 0em;">⋯</span><span class="MJXp-mo" id="MJXp-Span-2883" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2884">E</span><span class="MJXp-msubsup" id="MJXp-Span-2885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2886" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2887" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-2888">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-2889" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mo" id="MJXp-Span-2890" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2891" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2892">q</span><span class="MJXp-msubsup" id="MJXp-Span-2893"><span class="MJXp-mo" id="MJXp-Span-2894" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-2895" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2896">E</span><span class="MJXp-mo" id="MJXp-Span-2897">−</span><span class="MJXp-mn" id="MJXp-Span-2898">1</span></span></span></span></span><script type="math/tex" id="MathJax-Element-292">E\cdot p^{E-1}\cdot(-q)^1 + \cdots + Ep^{1}\cdot(-q)^{E-1}</script></span><span> appearing along the way are all multiples of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2899"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2900">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2901">q</span></span></span><script type="math/tex" id="MathJax-Element-293">pq</script></span><span>.</span></p><p><span>Therefore,</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2902"><span class="MJXp-msubsup" id="MJXp-Span-2903"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2904" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2905" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2906" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-2907"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2908" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2909" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2910" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-2911" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-2912" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2913">q</span><span class="MJXp-msubsup" id="MJXp-Span-2914"><span class="MJXp-mo" id="MJXp-Span-2915" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2916" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2917" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2918">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2919">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-294">C_2 \equiv p^E + (-q)^E \bmod pq</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2921">E</span></span></span><script type="math/tex" id="MathJax-Element-295">E</script></span><span> is even number, so</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2922"><span class="MJXp-msubsup" id="MJXp-Span-2923"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2924" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2925" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2926" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-2927"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2928" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2929" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2930" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-2931"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2932" style="margin-right: 0.05em;">q</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2933" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2934" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2935">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2936">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-296">C_2 \equiv p^E + q^E \bmod pq</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2937"><span class="MJXp-msubsup" id="MJXp-Span-2938"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2939" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2940" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2941" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-2942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2943" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2944" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2945" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-2946">2</span><span class="MJXp-msubsup" id="MJXp-Span-2947"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2948" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2949" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2950" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2951">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2952">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-297">C_1 + C_2 \equiv 2p^E \bmod pq</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2953"><span class="MJXp-msubsup" id="MJXp-Span-2954"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2955" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2956" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2957" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-2958"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2959" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2960" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2961" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-2962">0</span><span class="MJXp-mo" id="MJXp-Span-2963" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2964">p</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-298">C_1 + C_2 \equiv 0 \bmod p</script></span></p><p><span>As a result, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2965"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2966">p</span></span></span><script type="math/tex" id="MathJax-Element-299">p</script></span><span> can be found by computing the GCD (Greatest Common Divisor) of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2967"><span class="MJXp-msubsup" id="MJXp-Span-2968"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2969" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2970" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2971" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-2972"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2973" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2974" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-300">C_1 + C_2</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-2975"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2976">N</span></span></span><script type="math/tex" id="MathJax-Element-301">N</script></span><span>.</span></p><p><span>Similarly,</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2977"><span class="MJXp-msubsup" id="MJXp-Span-2978"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2979" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2980" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2981" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2982"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2983" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2984" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-2985" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-2986">2</span><span class="MJXp-msubsup" id="MJXp-Span-2987"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2988" style="margin-right: 0.05em;">q</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-2989" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-2990" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2991">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2992">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-302">C_2 - C_1 \equiv 2q^E \bmod pq</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-2993"><span class="MJXp-msubsup" id="MJXp-Span-2994"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2995" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-2996" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-2997" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-2998"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2999" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3000" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3001" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-3002">0</span><span class="MJXp-mo" id="MJXp-Span-3003" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3004">q</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-303">C_2 - C_1 \equiv 0 \bmod q</script></span></p><p><span>and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3005"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3006">q</span></span></span><script type="math/tex" id="MathJax-Element-304">q</script></span><span> can be found by computing the GCD of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3007"><span class="MJXp-msubsup" id="MJXp-Span-3008"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3009" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3010" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3011" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-3012"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3013" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3014" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-305">C_2 - C_1</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3015"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3016">N</span></span></span><script type="math/tex" id="MathJax-Element-306">N</script></span><span>.</span></p><p><span>If </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3017"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3018">p</span><span class="MJXp-mo" id="MJXp-Span-3019" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3020">q</span></span></span><script type="math/tex" id="MathJax-Element-307">p, q</script></span><span> are known, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3021"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3022">r</span></span></span><script type="math/tex" id="MathJax-Element-308">r</script></span><span> is also known immediately.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code">p = GCD(c1 + c2, n)
<span class="hljs-keyword">assert</span> is_prime(p)

q = GCD(c2 - c1, n)
<span class="hljs-keyword">assert</span> is_prime(q)

r = n // (p * q)
<span class="hljs-keyword">assert</span> is_prime(r) <span class="hljs-keyword">and</span> n == p * q * r
</div></div></code></pre><p><span>In the following, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3023"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3024">p</span><span class="MJXp-mo" id="MJXp-Span-3025" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3026">q</span><span class="MJXp-mo" id="MJXp-Span-3027" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3028">r</span></span></span><script type="math/tex" id="MathJax-Element-309">p, q, r</script></span><span> are capitalized as they are known.</span></p><h3 id="Square-Root-Modulo-N" data-id="Square-Root-Modulo-N"><a class="anchor hidden-xs" href="#Square-Root-Modulo-N" title="Square-Root-Modulo-N"><span class="octicon octicon-link"></span></a><span>Square Root Modulo </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3029"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3030">N</span></span></span><script type="math/tex" id="MathJax-Element-310">N</script></span></h3><p><span>Now that prime factorization is done, we want to decrypt with RSA, but the secret key </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3031"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3032">d</span></span></span><script type="math/tex" id="MathJax-Element-311">d</script></span><span> cannot be computed.</span><br>
<span>In other words, there is no </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3033"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3034">d</span></span></span><script type="math/tex" id="MathJax-Element-312">d</script></span><span> such that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3035"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3036">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3037">d</span><span class="MJXp-mo" id="MJXp-Span-3038" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-3039">1</span><span class="MJXp-mo" id="MJXp-Span-3040" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mo" id="MJXp-Span-3041" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3042">P</span><span class="MJXp-mo" id="MJXp-Span-3043" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3044">1</span><span class="MJXp-mo" id="MJXp-Span-3045" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3046" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3047">Q</span><span class="MJXp-mo" id="MJXp-Span-3048" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3049">1</span><span class="MJXp-mo" id="MJXp-Span-3050" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3051" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3052">R</span><span class="MJXp-mo" id="MJXp-Span-3053" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3054">1</span><span class="MJXp-mo" id="MJXp-Span-3055" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-313">Ed \equiv 1 \bmod (P-1)(Q-1)(R-1)</script></span><span>.</span></p><p><span>The reason is obvious: If such a </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3056"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3057">d</span></span></span><script type="math/tex" id="MathJax-Element-314">d</script></span><span> exists,</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-3058"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3059">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3060">d</span><span class="MJXp-mo" id="MJXp-Span-3061" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3062">1</span><span class="MJXp-mo" id="MJXp-Span-3063" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3064">k</span><span class="MJXp-mo" id="MJXp-Span-3065" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3066">P</span><span class="MJXp-mo" id="MJXp-Span-3067" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3068">1</span><span class="MJXp-mo" id="MJXp-Span-3069" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3070" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3071">Q</span><span class="MJXp-mo" id="MJXp-Span-3072" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3073">1</span><span class="MJXp-mo" id="MJXp-Span-3074" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3075" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3076">R</span><span class="MJXp-mo" id="MJXp-Span-3077" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3078">1</span><span class="MJXp-mo" id="MJXp-Span-3079" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-315">Ed = 1 + k(P-1)(Q-1)(R-1)</script></span></p><p><span>but</span></p><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3080"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3081">E</span></span></span><script type="math/tex" id="MathJax-Element-316">E</script></span><span> is even, so </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3082"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3083">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3084">d</span></span></span><script type="math/tex" id="MathJax-Element-317">Ed</script></span><span> is also even</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3085"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3086">P</span><span class="MJXp-mo" id="MJXp-Span-3087" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3088">1</span></span></span><script type="math/tex" id="MathJax-Element-318">P-1</script></span><span> is even, so </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3089"><span class="MJXp-mn" id="MJXp-Span-3090">1</span><span class="MJXp-mo" id="MJXp-Span-3091" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3092">k</span><span class="MJXp-mo" id="MJXp-Span-3093" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3094">P</span><span class="MJXp-mo" id="MJXp-Span-3095" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3096">1</span><span class="MJXp-mo" id="MJXp-Span-3097" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3098" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3099">Q</span><span class="MJXp-mo" id="MJXp-Span-3100" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3101">1</span><span class="MJXp-mo" id="MJXp-Span-3102" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3103" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3104">R</span><span class="MJXp-mo" id="MJXp-Span-3105" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-3106">1</span><span class="MJXp-mo" id="MJXp-Span-3107" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-319">1 + k(P-1)(Q-1)(R-1)</script></span><span> is odd</span></li>
</ul><p><span>, this is a contradiction.</span></p><p><span>So what should we do?</span></p><p><span>We can decrypt </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3108"><span class="MJXp-msup" id="MJXp-Span-3109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3110" style="margin-right: 0.05em;">c</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-3111" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-3112" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3114" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3115" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3116">65537</span></span></span></span></span><script type="math/tex" id="MathJax-Element-320">c' = m^{65537}</script></span><span> with ordinary RSA. Therefore, it is sufficient to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3117"><span class="MJXp-msup" id="MJXp-Span-3118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3119" style="margin-right: 0.05em;">c</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-3120" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-321">c'</script></span><span> such that</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-3121"><span class="MJXp-msubsup" id="MJXp-Span-3122"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3123" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3124" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-3125">′</span><span class="MJXp-mn" id="MJXp-Span-3126">2</span></span></span><span class="MJXp-mo" id="MJXp-Span-3127" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3128">C</span><span class="MJXp-mo" id="MJXp-Span-3129" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3130">N</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-322">c'^2 = C \bmod N</script></span></p><p><span>If </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3131"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3132">N</span></span></span><script type="math/tex" id="MathJax-Element-323">N</script></span><span> is a composite number, square root calculations are difficult.</span><br>
<span>However, it is easy to compute in a prime modulus.</span></p><p><span>So, from the square root of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3133"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3134">C</span></span></span><script type="math/tex" id="MathJax-Element-324">C</script></span><span> in modulo </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3136">P</span></span></span><script type="math/tex" id="MathJax-Element-325">P</script></span><span>, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3137"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3138">Q</span></span></span><script type="math/tex" id="MathJax-Element-326">Q</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3140">R</span></span></span><script type="math/tex" id="MathJax-Element-327">R</script></span><span>, use CRT (Chinese Remainder Theorem) to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3141"><span class="MJXp-msup" id="MJXp-Span-3142"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3143" style="margin-right: 0.05em;">c</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-3144" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-328">c'</script></span><span>.</span></p><p><span>Note that there are two kinds of square roots for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3145"><span class="MJXp-mo" id="MJXp-Span-3146" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3147">P</span></span></span><script type="math/tex" id="MathJax-Element-329">\bmod P</script></span><span> (</span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3148"><span class="MJXp-mo" id="MJXp-Span-3149" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3150">Q</span></span></span><script type="math/tex" id="MathJax-Element-330">\bmod Q</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3151"><span class="MJXp-mo" id="MJXp-Span-3152" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3153">R</span></span></span><script type="math/tex" id="MathJax-Element-331">\bmod R</script></span><span> as well, i.e., there are 8 candidates for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3154"><span class="MJXp-msup" id="MJXp-Span-3155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3156" style="margin-right: 0.05em;">c</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-3157" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-332">c'</script></span><span>).</span></p><h3 id="Solver" data-id="Solver"><a class="anchor hidden-xs" href="#Solver" title="Solver"><span class="octicon octicon-link"></span></a><span>Solver</span></h3><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># solver.sage</span>
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes

e = <span class="hljs-number">131074</span>
n = <span class="hljs-number">587926815910957928506680558951380405698765957736660571041732511939308424899531125274073420353104933723578377320050609109973567093301465914201779673281463229043539776071848986139657349676692718889679333084650490543298408820393827884588301690661795023628407437321580294262453190086595632660415087049509707898690300735866307908684649384093580089579066927072306239235691848372795522705863097316041992762430583002647242874432616919707048872023450089003861892443175057</span>
c1 = <span class="hljs-number">92883677608593259107779614675340187389627152895287502713709168556367680044547229499881430201334665342299031232736527233576918819872441595012586353493994687554993850861284698771856524058389658082754805340430113793873484033099148690745409478343585721548477862484321261504696340989152768048722100452380071775092776100545951118812510485258151625980480449364841902275382168289834835592610827304151460005023283820809211181376463308232832041617730995269229706500778999</span>
c2 = <span class="hljs-number">46236476834113109832988500718245623668321130659753618396968458085371710919173095425312826538494027621684566936459628333712619089451210986870323342712049966508077935506288610960911880157875515961210931283604254773154117519276154872411593688579702575956948337592659599321668773003355325067112181265438366718228446448254354388848428310614023369655106639341893255469632846938342940907002778575355566044700049191772800859575284398246115317686284789740336401764665472</span>
cm = <span class="hljs-number">357982930129036534232652210898740711702843117900101310390536835935714799577440705618646343456679847613022604725158389766496649223820165598357113877892553200702943562674928769780834623569501835458020870291541041964954580145140283927441757571859062193670500697241155641475887438532923910772758985332976303801843564388289302751743334888885607686066607804176327367188812325636165858751339661015759861175537925741744142766298156196248822715533235458083173713289585866</span>

p = GCD(c1 + c2, n)
<span class="hljs-keyword">assert</span> is_prime(p)

q = GCD(c2 - c1, n)
<span class="hljs-keyword">assert</span> is_prime(q)

r = n // (p * q)
<span class="hljs-keyword">assert</span> is_prime(r) <span class="hljs-keyword">and</span> n == p * q * r

sqrt_p = <span class="hljs-built_in">int</span>(mod(cm, p).sqrt())
sqrt_p_ls = [sqrt_p, <span class="hljs-built_in">int</span>(p) - sqrt_p]

sqrt_q = <span class="hljs-built_in">int</span>(mod(cm, q).sqrt())
sqrt_q_ls = [sqrt_q, <span class="hljs-built_in">int</span>(q) - sqrt_q]

sqrt_r = <span class="hljs-built_in">int</span>(mod(cm, r).sqrt())
sqrt_r_ls = [sqrt_r, <span class="hljs-built_in">int</span>(r) - sqrt_r]

<span class="hljs-keyword">for</span> _p <span class="hljs-keyword">in</span> sqrt_p_ls:
    <span class="hljs-keyword">for</span> _q <span class="hljs-keyword">in</span> sqrt_q_ls:
        <span class="hljs-keyword">for</span> _r <span class="hljs-keyword">in</span> sqrt_r_ls:
            _c = <span class="hljs-built_in">int</span>(CRT([_p, _q, _r], [p, q, r]))
            <span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(_c, <span class="hljs-number">2</span>, n) == cm
            d = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">65537</span>, -<span class="hljs-number">1</span>, (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)*(r-<span class="hljs-number">1</span>)))
            m = long_to_bytes(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(_c, d, n)))
            <span class="hljs-keyword">if</span> <span class="hljs-string">b'SECCON'</span> <span class="hljs-keyword">in</span> m:
                <span class="hljs-built_in">print</span>(m)
                <span class="hljs-comment"># SECCON{being_able_to_s0lve_this_1s_great!}</span>
</div></div></code></pre><h2 id="BBB-136-pts-50-solved" data-id="BBB-136-pts-50-solved"><a class="anchor hidden-xs" href="#BBB-136-pts-50-solved" title="BBB-136-pts-50-solved"><span class="octicon octicon-link"></span></a><span>BBB (136 pts, 50 solved)</span></h2><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long, getPrime
<span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint
<span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd
<span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> FLAG
<span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> urandom


<span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(FLAG) &lt; <span class="hljs-number">100</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_key</span>(<span class="hljs-params">rng, seed</span>):
    e = rng(seed)
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(randint(<span class="hljs-number">10</span>,<span class="hljs-number">100</span>)):
            e = rng(e)
        p = getPrime(<span class="hljs-number">1024</span>)
        q = getPrime(<span class="hljs-number">1024</span>)
        phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)
        <span class="hljs-keyword">if</span> gcd(e, phi) == <span class="hljs-number">1</span>:
            <span class="hljs-keyword">break</span>

    n = p*q
    <span class="hljs-keyword">return</span> (n, e)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_params</span>():
    p = getPrime(<span class="hljs-number">1024</span>)
    a = randint(<span class="hljs-number">0</span>, p-<span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span> (p,a)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    p,a = generate_params()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"[+] The parameters of RNG:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a=}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{p=}</span>"</span>)
    b = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"[+] Inject [b]ackdoor!!: "</span>))
    rng = <span class="hljs-keyword">lambda</span> x: (x**<span class="hljs-number">2</span> + a*x + b) % p

    keys = []
    seeds = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
        seed = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"[+] Please input seed: "</span>))
        seed %= p
        <span class="hljs-keyword">if</span> seed <span class="hljs-keyword">in</span> seeds:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"[!] Same seeds are not allowed!!"</span>)
            exit()
        seeds.append(seed)
        n, e = generate_key(rng, seed)
        <span class="hljs-keyword">if</span> e &lt;= <span class="hljs-number">10</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"[!] `e` is so small!!"</span>)
            exit()

        keys.append((n,e))

    flag = bytes_to_long(FLAG + urandom(<span class="hljs-number">16</span>))
    <span class="hljs-keyword">for</span> n,e <span class="hljs-keyword">in</span> keys:
        c = <span class="hljs-built_in">pow</span>(flag, e, n)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[+] Public Key:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{n=}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{e=}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[+] Cipher Text:"</span>, c)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</div></div></code></pre><h3 id="Overview1" data-id="Overview"><a class="anchor hidden-xs" href="#Overview1" title="Overview1"><span class="octicon octicon-link"></span></a><span>Overview</span></h3><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3159">f</span><span class="MJXp-mo" id="MJXp-Span-3160" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3161">x</span><span class="MJXp-mo" id="MJXp-Span-3162" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3163" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3164"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3165" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3166" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3167" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3168">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3169">x</span><span class="MJXp-mo" id="MJXp-Span-3170" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3171">B</span><span class="MJXp-mo" id="MJXp-Span-3172" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3173">P</span></span></span><script type="math/tex" id="MathJax-Element-333">f(x) \equiv x^2 + Ax + B \bmod P</script></span>
<ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3174"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3175">A</span></span></span><script type="math/tex" id="MathJax-Element-334">A</script></span><span> is given. You can set your own </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3176"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3177">B</span></span></span><script type="math/tex" id="MathJax-Element-335">B</script></span></li>
</ul>
</li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3178"><span class="MJXp-msubsup" id="MJXp-Span-3179"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3180" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3181" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3182" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3183"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3184" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3185" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-3186">(</span><span class="MJXp-msubsup" id="MJXp-Span-3187"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3188" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3189" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3190">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-3191" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-3192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3193" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3194" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3195" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-336">E_i = f^{(k_i)}(X_i)</script></span>
<ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3196"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3197">i</span><span class="MJXp-mo" id="MJXp-Span-3198" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3199">1</span><span class="MJXp-mo" id="MJXp-Span-3200" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3201">2</span><span class="MJXp-mo" id="MJXp-Span-3202" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3203">3</span><span class="MJXp-mo" id="MJXp-Span-3204" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3205">4</span><span class="MJXp-mo" id="MJXp-Span-3206" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3207">5</span></span></span><script type="math/tex" id="MathJax-Element-337">i = 1, 2, 3, 4, 5</script></span></li>
<li><span>You can set your own </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3208"><span class="MJXp-msubsup" id="MJXp-Span-3209"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3210" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3211" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-338">X_i</script></span></li>
<li><span>Duplication of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3212"><span class="MJXp-msubsup" id="MJXp-Span-3213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3214" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3215" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-339">X_i</script></span><span> is not allowed</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3216"><span class="MJXp-msubsup" id="MJXp-Span-3217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3218" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3219" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3220" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-3221">11</span></span></span><script type="math/tex" id="MathJax-Element-340">k_i \leq 11</script></span><span> is a random value</span></li>
<li><span>Define </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3222"><span class="MJXp-msubsup" id="MJXp-Span-3223"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3224" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3225" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-3226">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3227">k</span><span class="MJXp-mo" id="MJXp-Span-3228">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-3229" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3230">x</span><span class="MJXp-mo" id="MJXp-Span-3231" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-341">f^{(k)}(x)</script></span><span> as </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3232"><span class="MJXp-msubsup" id="MJXp-Span-3233"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3234" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3235" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-3236">(</span><span class="MJXp-mn" id="MJXp-Span-3237">2</span><span class="MJXp-mo" id="MJXp-Span-3238">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-3239" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3240">f</span><span class="MJXp-mo" id="MJXp-Span-3241" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3242">f</span><span class="MJXp-mo" id="MJXp-Span-3243" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3244">x</span><span class="MJXp-mo" id="MJXp-Span-3245" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3246" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-342">f^{(2)} = f(f(x))</script></span><span>，</span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3247"><span class="MJXp-msubsup" id="MJXp-Span-3248"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3249" style="margin-right: 0.05em;">f</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3250" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-3251">(</span><span class="MJXp-mn" id="MJXp-Span-3252">3</span><span class="MJXp-mo" id="MJXp-Span-3253">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-3254" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3255">x</span><span class="MJXp-mo" id="MJXp-Span-3256" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3257" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3258">f</span><span class="MJXp-mo" id="MJXp-Span-3259" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3260">f</span><span class="MJXp-mo" id="MJXp-Span-3261" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3262">f</span><span class="MJXp-mo" id="MJXp-Span-3263" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3264">x</span><span class="MJXp-mo" id="MJXp-Span-3265" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3266" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3267" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-343">f^{(3)}(x) = f(f(f(x)))</script></span><span>…</span></li>
<li><span>If </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3268"><span class="MJXp-msubsup" id="MJXp-Span-3269"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3270" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3271" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3272" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-3273">10</span></span></span><script type="math/tex" id="MathJax-Element-344">E_i \leq 10</script></span><span>, the program is forced to terminate.</span></li>
</ul>
</li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3274"><span class="MJXp-msubsup" id="MJXp-Span-3275"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3276" style="margin-right: 0.05em;">N</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3277" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3278" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3279"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3280" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3281" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-msubsup" id="MJXp-Span-3282"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3283" style="margin-right: 0.05em;">q</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3284" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-345">N_i =p_iq_i</script></span><span>: 2048 bits</span>
<ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3285"><span class="MJXp-msubsup" id="MJXp-Span-3286"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3287" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3288" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-346">p_i</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3290">P</span></span></span><script type="math/tex" id="MathJax-Element-347">P</script></span><span> and appearing in </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3291"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3292">f</span><span class="MJXp-mo" id="MJXp-Span-3293" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3294">x</span><span class="MJXp-mo" id="MJXp-Span-3295" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-348">f(x)</script></span><span> are completely unrelated.</span></li>
</ul>
</li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3296"><span class="MJXp-msubsup" id="MJXp-Span-3297"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3298" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3299" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3300" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3301"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3302" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3303" style="vertical-align: 0.5em;"><span class="MJXp-msubsup" id="MJXp-Span-3304"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3305" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3306" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3307" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-msubsup" id="MJXp-Span-3308"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3309" style="margin-right: 0.05em;">N</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3310" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-349">C_i \equiv m^{E_i} \bmod N_i</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3311"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3312">m</span></span></span><script type="math/tex" id="MathJax-Element-350">m</script></span><span> is less than 115 bytes. The lower 16 bytes of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3313"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3314">m</span></span></span><script type="math/tex" id="MathJax-Element-351">m</script></span><span> change with each </span><code>nc</code><span> connection.</span></li>
</ul><p><span>The challenge is to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3316">m</span></span></span><script type="math/tex" id="MathJax-Element-352">m</script></span><span> under the above conditions.</span></p><h3 id="Ignore-k_i" data-id="Ignore-k_i"><a class="anchor hidden-xs" href="#Ignore-k_i" title="Ignore-k_i"><span class="octicon octicon-link"></span></a><span>Ignore </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3317"><span class="MJXp-msubsup" id="MJXp-Span-3318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3319" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3320" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-353">k_i</script></span></h3><p><span>Since </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3321"><span class="MJXp-msubsup" id="MJXp-Span-3322"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3323" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3324" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-354">k_i</script></span><span> is completely uncontrollable, we cannot predict the output of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3325"><span class="MJXp-msubsup" id="MJXp-Span-3326"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3327" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3328" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-355">E_i</script></span><span> from our side if we do nothing.</span><br>
<span>Therefore, the first prerequisite is to make </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3330">f</span><span class="MJXp-mo" id="MJXp-Span-3331" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-3332"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3333" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3334" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3335" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3336" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3338" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3339" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-356">f(E_i) = E_i</script></span><span> at some point so that the result is fixed at </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3340"><span class="MJXp-msubsup" id="MJXp-Span-3341"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3342" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3343" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-357">E_i</script></span><span> no matter how many times the loop is performed.</span></p><p><span>Note that if the value of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3344"><span class="MJXp-msubsup" id="MJXp-Span-3345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3346" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3347" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-358">E_i</script></span><span> is known, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3349">B</span></span></span><script type="math/tex" id="MathJax-Element-359">B</script></span><span> can be obtained trivially by solving </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3351">f</span><span class="MJXp-mo" id="MJXp-Span-3352" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-3353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3354" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3355" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3356" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3357" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3358"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3359" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3360" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-360">f(E_i)=E_i</script></span></p><h3 id="Fix-E_i--11-is-it-OK" data-id="Fix-E_i--11-is-it-OK"><a class="anchor hidden-xs" href="#Fix-E_i--11-is-it-OK" title="Fix-E_i--11-is-it-OK"><span class="octicon octicon-link"></span></a><span>Fix </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3361"><span class="MJXp-msubsup" id="MJXp-Span-3362"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3363" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3364" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3365" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3366">11</span></span></span><script type="math/tex" id="MathJax-Element-361">E_i = 11</script></span><span>, is it OK?</span></h3><blockquote>
<p><span>If </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3367"><span class="MJXp-msubsup" id="MJXp-Span-3368"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3369" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3370" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3371" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span><span class="MJXp-mn" id="MJXp-Span-3372">10</span></span></span><script type="math/tex" id="MathJax-Element-362">E_i \leq 10</script></span><span>, the program is forced to terminate.</span></p>
</blockquote><p><span>Then intuitively we would think </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3373"><span class="MJXp-msubsup" id="MJXp-Span-3374"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3375" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3376" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3377" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3378">11</span></span></span><script type="math/tex" id="MathJax-Element-363">E_i=11</script></span><span>.</span></p><p><span>First, let us assume that we have done so (We will consider later how to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3379"><span class="MJXp-msubsup" id="MJXp-Span-3380"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3381" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3382" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-364">X_i</script></span><span> such that there is an </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3383"><span class="MJXp-msubsup" id="MJXp-Span-3384"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3385" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3386" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3387" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3388">11</span></span></span><script type="math/tex" id="MathJax-Element-365">E_i = 11</script></span><span> loop).</span></p><p><span>Then, given five RSA ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3389"><span class="MJXp-msubsup" id="MJXp-Span-3390"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3391" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3392" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-366">C_i</script></span><span> and public key </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3393"><span class="MJXp-msubsup" id="MJXp-Span-3394"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3395" style="margin-right: 0.05em;">N</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3396" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-367">N_i</script></span><span> such that:</span></p><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3397"><span class="MJXp-msubsup" id="MJXp-Span-3398"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3399" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3400" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3401">11</span></span></span><span class="MJXp-mo" id="MJXp-Span-3402" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3403"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3404" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3405" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3406" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-msubsup" id="MJXp-Span-3407"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3408" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3409" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-368">m^{11} \equiv C_1 \bmod N_1</script></span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3410"><span class="MJXp-mo" id="MJXp-Span-3411" style="margin-left: 0em; margin-right: 0em;">⋯</span></span></span><script type="math/tex" id="MathJax-Element-369">\cdots</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3412"><span class="MJXp-msubsup" id="MJXp-Span-3413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3414" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3415" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3416">11</span></span></span><span class="MJXp-mo" id="MJXp-Span-3417" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3418"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3419" style="margin-right: 0.05em;">C</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3420" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-3421">5</span></span></span><span class="MJXp-mo" id="MJXp-Span-3422" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-msubsup" id="MJXp-Span-3423"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3424" style="margin-right: 0.05em;">N</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3425" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-3426">5</span></span></span></span></span><script type="math/tex" id="MathJax-Element-370">m^{11} \equiv C_{5} \bmod N_{5}</script></span></li>
</ul><p><span>Using CRT, we obtain </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3427"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3428">C</span></span></span><script type="math/tex" id="MathJax-Element-371">C</script></span><span> such that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3429"><span class="MJXp-msubsup" id="MJXp-Span-3430"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3431" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3432" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3433">11</span></span></span><span class="MJXp-mo" id="MJXp-Span-3434" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3435">C</span><span class="MJXp-mo" id="MJXp-Span-3436" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-msubsup" id="MJXp-Span-3437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3438" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3439" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3440"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3441" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3442" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-3443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3444" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3445" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-3446"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3447" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3448" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-msubsup" id="MJXp-Span-3449"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3450" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3451" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-372">m^{11} = C \bmod N_1N_2N_3N_4N_5</script></span><span>.</span></p><p><span>In this case,</span></p><ul>
<li><span>since </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3452"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3453">m</span></span></span><script type="math/tex" id="MathJax-Element-373">m</script></span><span> is less than </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3454"><span class="MJXp-mn" id="MJXp-Span-3455">115</span></span></span><script type="math/tex" id="MathJax-Element-374">115</script></span><span> bytes(= </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3456"><span class="MJXp-mn" id="MJXp-Span-3457">920</span></span></span><script type="math/tex" id="MathJax-Element-375">920</script></span><span> bits), </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3458"><span class="MJXp-msubsup" id="MJXp-Span-3459"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3460" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3461" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3462">11</span></span></span></span></span><script type="math/tex" id="MathJax-Element-376">m^{11}</script></span><span> is less than </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3463"><span class="MJXp-mn" id="MJXp-Span-3464">920</span><span class="MJXp-mo" id="MJXp-Span-3465" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-3466">11</span><span class="MJXp-mo" id="MJXp-Span-3467" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3468">10120</span></span></span><script type="math/tex" id="MathJax-Element-377">920\cdot 11 = 10120</script></span><span> bits.</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3469"><span class="MJXp-msubsup" id="MJXp-Span-3470"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3471" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3472" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3473"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3474" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3475" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-3476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3477" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3478" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-3479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3480" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3481" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-msubsup" id="MJXp-Span-3482"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3483" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3484" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-378">N_1N_2N_3N_4N_5</script></span><span> is nealry </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3485"><span class="MJXp-mn" id="MJXp-Span-3486">2048</span><span class="MJXp-mo" id="MJXp-Span-3487" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mn" id="MJXp-Span-3488">5</span><span class="MJXp-mo" id="MJXp-Span-3489" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3490">10240</span></span></span><script type="math/tex" id="MathJax-Element-379">2048\cdot 5 = 10240</script></span><span> bits</span></li>
</ul><p><span>That is, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3491"><span class="MJXp-msubsup" id="MJXp-Span-3492"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3493" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3494" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3495">11</span></span></span></span></span><script type="math/tex" id="MathJax-Element-380">m^{11}</script></span><span> is sufficiently smaller than </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3496"><span class="MJXp-msubsup" id="MJXp-Span-3497"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3498" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3499" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3500"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3501" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3502" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-3503"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3504" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3505" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-3506"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3507" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3508" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-msubsup" id="MJXp-Span-3509"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3510" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3511" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-381">N_1N_2N_3N_4N_5</script></span><span> that no division (modular) operation occurs.</span><br>
<span>This means that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3512"><span class="MJXp-mo" id="MJXp-Span-3513" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span></span></span><script type="math/tex" id="MathJax-Element-382">\bmod</script></span><span> can be ignored:</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-3514"><span class="MJXp-msubsup" id="MJXp-Span-3515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3516" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3517" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3518">11</span></span></span><span class="MJXp-mo" id="MJXp-Span-3519" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3520">C</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-383">m^{11} = C</script></span></p><p><span>Finally, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3521"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3522">m</span></span></span><script type="math/tex" id="MathJax-Element-384">m</script></span><span> is obtained by computing the eleventh power root of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3523"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3524">C</span></span></span><script type="math/tex" id="MathJax-Element-385">C</script></span><span>.</span><br>
<span>It is an attack method called “Håstad’s Broadcast Attack”.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> gmpy2
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes

<span class="hljs-comment"># length: 5</span>
n_list = [...]
c_list = [...]

c = crt(c_list, n_list)
m, flag = gmpy2.iroot(<span class="hljs-built_in">int</span>(c), <span class="hljs-number">11</span>)
<span class="hljs-keyword">assert</span> flag
<span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(m)))
</div></div></code></pre><h3 id="Computation-of-X_i" data-id="Computation-of-X_i"><a class="anchor hidden-xs" href="#Computation-of-X_i" title="Computation-of-X_i"><span class="octicon octicon-link"></span></a><span>Computation of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3525"><span class="MJXp-msubsup" id="MJXp-Span-3526"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3527" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3528" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-386">X_i</script></span></h3><p><span>Solve </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3529"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3530">f</span><span class="MJXp-mo" id="MJXp-Span-3531" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3532">x</span><span class="MJXp-mo" id="MJXp-Span-3533" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3534" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3535">11</span></span></span><script type="math/tex" id="MathJax-Element-387">f(x) = 11</script></span><span> (i.e., </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3536"><span class="MJXp-msubsup" id="MJXp-Span-3537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3538" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3539" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3540" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3541">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3542">x</span><span class="MJXp-mo" id="MJXp-Span-3543" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3544">B</span><span class="MJXp-mo" id="MJXp-Span-3545" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mn" id="MJXp-Span-3546">11</span><span class="MJXp-mo" id="MJXp-Span-3547" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3548">P</span></span></span><script type="math/tex" id="MathJax-Element-388">x^2 + Ax + B \equiv 11 \bmod P</script></span><span>) and let the solution be </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3549"><span class="MJXp-msubsup" id="MJXp-Span-3550"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3551" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3552" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-389">X_1</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3553"><span class="MJXp-msubsup" id="MJXp-Span-3554"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3555" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3556" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-390">X_2</script></span></p><p><span>Note that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3557"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3558">x</span><span class="MJXp-mo" id="MJXp-Span-3559" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3560">11</span></span></span><script type="math/tex" id="MathJax-Element-391">x=11</script></span><span> is an obvious solution because we set the value of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3561"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3562">B</span></span></span><script type="math/tex" id="MathJax-Element-392">B</script></span><span> so that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3563"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3564">f</span><span class="MJXp-mo" id="MJXp-Span-3565" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-3566">11</span><span class="MJXp-mo" id="MJXp-Span-3567" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3568" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3569">11</span></span></span><script type="math/tex" id="MathJax-Element-393">f(11)=11</script></span><span>.</span></p><p><span>Let </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3570"><span class="MJXp-msubsup" id="MJXp-Span-3571"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3572" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3573" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3574" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3575">11</span></span></span><script type="math/tex" id="MathJax-Element-394">X_1 = 11</script></span><span>, w.l.o.g.</span></p><p><span>Next, solve </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3576"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3577">f</span><span class="MJXp-mo" id="MJXp-Span-3578" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3579">x</span><span class="MJXp-mo" id="MJXp-Span-3580" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3581" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3583" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3584" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-395">f(x) = X_2</script></span><span> and let the solution be </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3585"><span class="MJXp-msubsup" id="MJXp-Span-3586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3587" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3588" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-396">X_3</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3589"><span class="MJXp-msubsup" id="MJXp-Span-3590"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3591" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3592" style="vertical-align: -0.4em;">4</span></span></span></span><script type="math/tex" id="MathJax-Element-397">X_4</script></span><span>.</span><br>
<span>In this case, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3593"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3594">f</span><span class="MJXp-mo" id="MJXp-Span-3595" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3596">f</span><span class="MJXp-mo" id="MJXp-Span-3597" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-3598"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3599" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3600" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-3601" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3602" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3603" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3604">f</span><span class="MJXp-mo" id="MJXp-Span-3605" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-3606"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3607" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3608" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3609" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3610" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3611">11</span></span></span><script type="math/tex" id="MathJax-Element-398">f(f(X_3)) = f(X_2) = 11</script></span><span>, and it loops from then on (The same goes for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3612"><span class="MJXp-msubsup" id="MJXp-Span-3613"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3614" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3615" style="vertical-align: -0.4em;">4</span></span></span></span><script type="math/tex" id="MathJax-Element-399">X_4</script></span><span>).</span></p><p><span>Now, a quadratic equation on </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3616"><span class="MJXp-mo" id="MJXp-Span-3617" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3618">P</span></span></span><script type="math/tex" id="MathJax-Element-400">\bmod P</script></span><span> does not necessarily have two solutions in general.</span><br>
<span>(For example, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3619"><span class="MJXp-msubsup" id="MJXp-Span-3620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3621" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3622" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3623" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3624">2</span><span class="MJXp-TeXmathchoice" id="MJXp-Span-3625"><span class="MJXp-mspace" id="MJXp-Span-3626" style="width: 0.667em; height: 0em;"></span></span><span class="MJXp-mi" id="MJXp-Span-3627">mod</span><span class="MJXp-mspace" id="MJXp-Span-3628" style="width: 0.167em; height: 0em;"></span><span class="MJXp-mspace" id="MJXp-Span-3629" style="width: 0.167em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-3630">3</span></span></span><script type="math/tex" id="MathJax-Element-401">x^2 = 2 \mod 3</script></span><span> has no integer solution.)</span><br>
<span>Therefore, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3631"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3632">f</span><span class="MJXp-mo" id="MJXp-Span-3633" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3634">x</span><span class="MJXp-mo" id="MJXp-Span-3635" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3636" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3637"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3638" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3639" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-402">f(x) = X_2</script></span><span> may not have a solution.</span><br>
<span>If the solution does not exist, reconnect and reset.</span></p><p><span>Finally, solve </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3640"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3641">f</span><span class="MJXp-mo" id="MJXp-Span-3642" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3643">x</span><span class="MJXp-mo" id="MJXp-Span-3644" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3645" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3646"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3647" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3648" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-403">f(x) = X_3</script></span><span> or </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3649"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3650">f</span><span class="MJXp-mo" id="MJXp-Span-3651" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3652">x</span><span class="MJXp-mo" id="MJXp-Span-3653" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3654" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3656" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3657" style="vertical-align: -0.4em;">4</span></span></span></span><script type="math/tex" id="MathJax-Element-404">f(x) = X_4</script></span><span> (i.e., the pattern that enters the loop for the third time) in the same way to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3658"><span class="MJXp-msubsup" id="MJXp-Span-3659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3660" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3661" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-405">X_5</script></span><span>.</span><br>
<span>Again, if </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3662"><span class="MJXp-msubsup" id="MJXp-Span-3663"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3664" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3665" style="vertical-align: -0.4em;">5</span></span></span></span><script type="math/tex" id="MathJax-Element-406">X_5</script></span><span> is not found, reconnect.</span></p><h3 id="Solver1" data-id="Solver"><a class="anchor hidden-xs" href="#Solver1" title="Solver1"><span class="octicon octicon-link"></span></a><span>Solver</span></h3><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># solver.sage</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> gmpy2

<span class="hljs-comment">#config</span>
context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'i386'</span>)
context.log_level = <span class="hljs-string">'debug'</span>

FILE_NAME = <span class="hljs-string">"./pseudo.py"</span>

<span class="hljs-comment">#"""</span>
HOST = <span class="hljs-string">"BBB.seccon.games"</span>
PORT = <span class="hljs-number">8080</span>
<span class="hljs-string">"""
HOST = "localhost"
PORT = 7777
#"""</span>

<span class="hljs-comment"># solve x^2 + Ax + B = target mod p</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_seed</span>(<span class="hljs-params">target</span>):
    PR.&lt;x&gt; = PolynomialRing(GF(p))
    f = x**<span class="hljs-number">2</span> + a * x + b - target
    res = f.roots()
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) != <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> [res[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], res[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]], <span class="hljs-literal">True</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> [], <span class="hljs-literal">False</span>

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:    
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sys.argv[<span class="hljs-number">1</span>] == <span class="hljs-string">'r'</span>:
        conn = remote(HOST, PORT)
    <span class="hljs-keyword">else</span>:
        conn = process([<span class="hljs-string">"python3"</span>, FILE_NAME])

    conn.recvline()
    a = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b'='</span>)[<span class="hljs-number">1</span>])
    p = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b'='</span>)[<span class="hljs-number">1</span>])

    e = <span class="hljs-number">11</span>
    <span class="hljs-comment"># set backdoor B</span>
    b = (- e**<span class="hljs-number">2</span> - a * e + e) % p
    conn.sendlineafter(<span class="hljs-string">b': '</span>, <span class="hljs-built_in">str</span>(b).encode())


    <span class="hljs-comment"># find f(x) = e</span>
    <span class="hljs-comment"># always x=11 is a solution</span>
    x_ls, flag = find_seed(e)
    <span class="hljs-keyword">assert</span> flag <span class="hljs-keyword">and</span> <span class="hljs-number">11</span> <span class="hljs-keyword">in</span> x_ls
    x_1, x_2 = x_ls
    <span class="hljs-comment"># fix x_1 = 11</span>
    <span class="hljs-keyword">if</span> x_2 == <span class="hljs-number">11</span>:
        x_1, x_2 = x_2, x_1
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] x_1 and x_2 ok'</span>)

    <span class="hljs-comment"># find f(f(x)) = e, i.e., f(x) = x_2</span>
    <span class="hljs-comment"># solution does not always exist</span>
    x_ls, flag = find_seed(x_2)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> flag:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'[-] x_3 and x_4 not found. retry'</span>)
        conn.close()
        <span class="hljs-keyword">continue</span>
    x_3, x_4 = x_ls
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] x_3 and x_4 ok'</span>)

    <span class="hljs-comment"># find f(f(f(x))) = e, i.e., f(x) = x_3 or x_4</span>
    x_ls, flag = find_seed(x_3)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> flag:
        x_ls, flag = find_seed(x_4)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> flag:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'[-] x_5 not found. retry'</span>)
            conn.close()
            <span class="hljs-keyword">continue</span>
    x_5 = x_ls[<span class="hljs-number">0</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] x_5 ok'</span>)

    

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span>(<span class="hljs-built_in">set</span>([x_1, x_2, x_3, x_4, x_5]))) != <span class="hljs-number">5</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'[-] seed dupulicates. retry'</span>)
        conn.close()
        <span class="hljs-keyword">continue</span>

    conn.sendlineafter(<span class="hljs-string">b': '</span>, <span class="hljs-built_in">str</span>(x_1).encode())
    conn.sendlineafter(<span class="hljs-string">b': '</span>, <span class="hljs-built_in">str</span>(x_2).encode())
    conn.sendlineafter(<span class="hljs-string">b': '</span>, <span class="hljs-built_in">str</span>(x_3).encode())
    conn.sendlineafter(<span class="hljs-string">b': '</span>, <span class="hljs-built_in">str</span>(x_4).encode())
    conn.sendlineafter(<span class="hljs-string">b': '</span>, <span class="hljs-built_in">str</span>(x_5).encode())

    <span class="hljs-comment"># hastad broadcast attack</span>
    n_list = []
    e_list = []
    c_list = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
        conn.recvline()
        n = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b'='</span>)[<span class="hljs-number">1</span>])
        n_list.append(n)
        e = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b'='</span>)[<span class="hljs-number">1</span>])
        e_list.append(e)
        c = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b': '</span>)[<span class="hljs-number">1</span>])
        c_list.append(c)
    <span class="hljs-keyword">assert</span> e_list == [<span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>]
    
    c = crt(c_list, n_list)
    m, flag = gmpy2.iroot(<span class="hljs-built_in">int</span>(c), <span class="hljs-number">11</span>)
    <span class="hljs-keyword">assert</span> flag
    <span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(m)))
    <span class="hljs-comment"># SECCON{Can_you_find_d_in_bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbdbbbbbbbbbbbbbbbbbbbbbbbbbbbbb?}</span>
    conn.close()
    <span class="hljs-keyword">break</span>
</div></div></code></pre><h2 id="this_is_not_lsb-162-pts-34-solved" data-id="this_is_not_lsb-162-pts-34-solved"><a class="anchor hidden-xs" href="#this_is_not_lsb-162-pts-34-solved" title="this_is_not_lsb-162-pts-34-solved"><span class="octicon octicon-link"></span></a><span>this_is_not_lsb (162 pts. 34 solved)</span></h2><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag

p = getStrongPrime(<span class="hljs-number">512</span>)
q = getStrongPrime(<span class="hljs-number">512</span>)
e = <span class="hljs-number">65537</span>
n = p * q
phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)

d = <span class="hljs-built_in">pow</span>(e, -<span class="hljs-number">1</span>, phi)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"n = <span class="hljs-subst">{n}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"e = <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"flag_length = <span class="hljs-subst">{flag.bit_length()}</span>"</span>)

<span class="hljs-comment"># Oops! encrypt without padding!</span>
c = <span class="hljs-built_in">pow</span>(flag, e, n)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"c = <span class="hljs-subst">{c}</span>"</span>)

<span class="hljs-comment"># padding format: 0b0011111111........</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_padding</span>(<span class="hljs-params">c</span>):
    padding_pos = n.bit_length() - <span class="hljs-number">2</span>
    m = <span class="hljs-built_in">pow</span>(c, d, n)

    <span class="hljs-keyword">return</span> (m &gt;&gt; (padding_pos - <span class="hljs-number">8</span>)) == <span class="hljs-number">0xFF</span>


<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    c = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"c = "</span>))
    <span class="hljs-built_in">print</span>(check_padding(c))
</div></div></code></pre><h3 id="Overview2" data-id="Overview"><a class="anchor hidden-xs" href="#Overview2" title="Overview2"><span class="octicon octicon-link"></span></a><span>Overview</span></h3><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3666"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3667">E</span><span class="MJXp-mo" id="MJXp-Span-3668" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3669">65537</span></span></span><script type="math/tex" id="MathJax-Element-407">E = 65537</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3670"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3671">N</span><span class="MJXp-mo" id="MJXp-Span-3672" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3673">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3674">q</span></span></span><script type="math/tex" id="MathJax-Element-408">N = pq</script></span><span>: 1024 bits</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3675"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3676">C</span><span class="MJXp-mo" id="MJXp-Span-3677" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3678"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3679" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3680" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-3681" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3682">N</span></span></span><script type="math/tex" id="MathJax-Element-409">C \equiv m^E \bmod N</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3684">m</span></span></span><script type="math/tex" id="MathJax-Element-410">m</script></span><span>: 439 bits</span></li>
<li><span>Access to “an oracle that determines whether the first 10 bits are </span><code>00_1111_1111_...</code><span> when the decrypted plaintext is considered to be 1024 bits in length” is allowed.</span></li>
</ul><p><span>The challenge is to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3685"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3686">m</span></span></span><script type="math/tex" id="MathJax-Element-411">m</script></span><span> under the above conditions.</span></p><h3 id="RSA-homomorphism" data-id="RSA-homomorphism"><a class="anchor hidden-xs" href="#RSA-homomorphism" title="RSA-homomorphism"><span class="octicon octicon-link"></span></a><span>RSA homomorphism</span></h3><p><span>RSA has a property called homomorphism.</span><br>
<span>When the ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3687"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3688">C</span><span class="MJXp-mo" id="MJXp-Span-3689" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3690"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3691" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3692" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-3693" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3694">N</span></span></span><script type="math/tex" id="MathJax-Element-412">C \equiv m^E \bmod N</script></span><span> for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3695"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3696">m</span></span></span><script type="math/tex" id="MathJax-Element-413">m</script></span><span> is obtained, the ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3697"><span class="MJXp-msup" id="MJXp-Span-3698"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3699" style="margin-right: 0.05em;">C</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-3700" style="vertical-align: 0.5em;">′</span></span></span></span><script type="math/tex" id="MathJax-Element-414">C'</script></span><span> for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3701"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3702">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3703">m</span></span></span><script type="math/tex" id="MathJax-Element-415">Am</script></span><span> can be computed by</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-3704"><span class="MJXp-msup" id="MJXp-Span-3705"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3706" style="margin-right: 0.05em;">C</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-3707" style="vertical-align: 0.5em;">′</span></span><span class="MJXp-mo" id="MJXp-Span-3708" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mo" id="MJXp-Span-3709" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3710">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3711">m</span><span class="MJXp-msubsup" id="MJXp-Span-3712"><span class="MJXp-mo" id="MJXp-Span-3713" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3714" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mo" id="MJXp-Span-3715" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-3716"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3717" style="margin-right: 0.05em;">A</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3718" style="vertical-align: 0.5em;">E</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3719">C</span><span class="MJXp-mo" id="MJXp-Span-3720" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3721">N</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-416">C' \equiv (Am)^E = A^EC \bmod N</script></span></p><h3 id="Find-One-Example-where-the-Oracle-Returns-True" data-id="Find-One-Example-where-the-Oracle-Returns-True"><a class="anchor hidden-xs" href="#Find-One-Example-where-the-Oracle-Returns-True" title="Find-One-Example-where-the-Oracle-Returns-True"><span class="octicon octicon-link"></span></a><span>Find One Example where the Oracle Returns </span><code>True</code></h3><p><span>First, I searched for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3722"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3723">k</span></span></span><script type="math/tex" id="MathJax-Element-417">k</script></span><span> such that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3724"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3725">k</span><span class="MJXp-mo" id="MJXp-Span-3726" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3727">m</span></span></span><script type="math/tex" id="MathJax-Element-418">k\cdot m</script></span><span> begins with </span><code>1111_1111</code><span>.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long

flag = <span class="hljs-string">b'SECCON{'</span> + os.urandom(<span class="hljs-number">47</span>) + <span class="hljs-string">b'}'</span>
m = bytes_to_long(flag)
<span class="hljs-keyword">assert</span> m.bit_length() == <span class="hljs-number">439</span>

k = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">bin</span>(m * k)[<span class="hljs-number">2</span>:<span class="hljs-number">10</span>] == <span class="hljs-string">'11111111'</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'k = <span class="hljs-subst">{k}</span>'</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'length = <span class="hljs-subst">{(m * k).bit_length()}</span>'</span>)
        <span class="hljs-keyword">break</span>
    k += <span class="hljs-number">1</span>
    
<span class="hljs-comment"># k = 49</span>
<span class="hljs-comment"># length = 444</span>
</div></div></code></pre><p><span>I tried several times, and the result was the same each time.</span><br>
<span>In other words, it seems safe to assume that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3728"><span class="MJXp-mn" id="MJXp-Span-3729">49</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3730">m</span></span></span><script type="math/tex" id="MathJax-Element-419">49m</script></span><span> is a 444-bit value starting from </span><code>1111_1111</code><span>.</span></p><p><span>(If you want to evaluate it properly, consider the maximum and minimum values of the flag candidates and verify them.)</span></p><p><span>Thus, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3731"><span class="MJXp-mn" id="MJXp-Span-3732">49</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3733">m</span><span class="MJXp-mo" id="MJXp-Span-3734" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-3735"><span class="MJXp-mn" id="MJXp-Span-3736" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3737" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3738">578</span></span></span></span></span><script type="math/tex" id="MathJax-Element-420">49m \cdot 2^{578}</script></span><span> is “a 1024-bit value starting from </span><code>00_1111_1111</code><span>”.</span></p><h3 id="Refine-the-Range-of-m" data-id="Refine-the-Range-of-m"><a class="anchor hidden-xs" href="#Refine-the-Range-of-m" title="Refine-the-Range-of-m"><span class="octicon octicon-link"></span></a><span>Refine the Range of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3739"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3740">m</span></span></span><script type="math/tex" id="MathJax-Element-421">m</script></span></h3><p><span>Derived from this, we find the following:</span></p><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3741"><span class="MJXp-mn" id="MJXp-Span-3742">49</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3743">m</span><span class="MJXp-mo" id="MJXp-Span-3744" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-3745"><span class="MJXp-mn" id="MJXp-Span-3746" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3747" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3748">577</span></span></span></span></span><script type="math/tex" id="MathJax-Element-422">49m \cdot 2^{577}</script></span><span> is “a 1024-bit value starting from </span><code>00_0111_1111_...</code><span>”</span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3749"><span class="MJXp-mo" id="MJXp-Span-3750" style="margin-left: 0.333em; margin-right: 0.333em;">→</span></span></span><script type="math/tex" id="MathJax-Element-423">\rightarrow</script></span><span> the oracle returns </span><code>False</code></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3751"><span class="MJXp-mn" id="MJXp-Span-3752">49</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3753">m</span><span class="MJXp-mo" id="MJXp-Span-3754" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-3755"><span class="MJXp-mn" id="MJXp-Span-3756" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3757" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3758">578</span></span></span></span></span><script type="math/tex" id="MathJax-Element-424">49m \cdot 2^{578}</script></span><span> is “a 1024-bit value starting from </span><code>00_1111_1111_...</code><span>”</span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3759"><span class="MJXp-mo" id="MJXp-Span-3760" style="margin-left: 0.333em; margin-right: 0.333em;">→</span></span></span><script type="math/tex" id="MathJax-Element-425">\rightarrow</script></span><span> the oracle returns </span><code>True</code></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3761"><span class="MJXp-mn" id="MJXp-Span-3762">49</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3763">m</span><span class="MJXp-mo" id="MJXp-Span-3764" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-msubsup" id="MJXp-Span-3765"><span class="MJXp-mn" id="MJXp-Span-3766" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3767" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-3768">579</span></span></span></span></span><script type="math/tex" id="MathJax-Element-426">49m \cdot 2^{579}</script></span><span> is “a 1024-bit value starting from </span><code>01_1111_111?_...</code><span>”</span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3769"><span class="MJXp-mo" id="MJXp-Span-3770" style="margin-left: 0.333em; margin-right: 0.333em;">→</span></span></span><script type="math/tex" id="MathJax-Element-427">\rightarrow</script></span><span> the oracle returns </span><code>False</code></li>
</ul><p><span>What are the boundaries at which the oracle’s results change?</span></p><p><span>Find the value of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3771"><span class="MJXp-msubsup" id="MJXp-Span-3772"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3773" style="margin-right: 0.05em;">k</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3774" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3775">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3776">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3777">n</span></span></span></span></span><script type="math/tex" id="MathJax-Element-428">k_{min}</script></span><span> (the boundary where </span><code>False</code><span> changes to </span><code>True</code><span>), and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3778"><span class="MJXp-msubsup" id="MJXp-Span-3779"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3780" style="margin-right: 0.05em;">k</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3781" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3782">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3783">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3784">x</span></span></span></span></span><script type="math/tex" id="MathJax-Element-429">k_{max}</script></span><span> (where </span><code>True</code><span> changes to </span><code>False</code><span>), respectively, by a binary search.</span></p><p><span>These values satisfy the following:</span></p><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3785"><span class="MJXp-msubsup" id="MJXp-Span-3786"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3787" style="margin-right: 0.05em;">k</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3788" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3789">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3790">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3791">n</span></span></span><span class="MJXp-mo" id="MJXp-Span-3792" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3793">m</span><span class="MJXp-mo" id="MJXp-Span-3794" style="margin-left: 0.333em; margin-right: 0.333em;">≥</span></span></span><script type="math/tex" id="MathJax-Element-430">k_{min} \times m \geq</script></span><span> </span><code>00_1111_1111_0000_..._0000</code></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3795"><span class="MJXp-msubsup" id="MJXp-Span-3796"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3797" style="margin-right: 0.05em;">k</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-3798" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3799">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3800">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3801">x</span></span></span><span class="MJXp-mo" id="MJXp-Span-3802" style="margin-left: 0.267em; margin-right: 0.267em;">×</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3803">m</span><span class="MJXp-mo" id="MJXp-Span-3804" style="margin-left: 0.333em; margin-right: 0.333em;">≤</span></span></span><script type="math/tex" id="MathJax-Element-431">k_{max} \times m \leq</script></span><span> </span><code>01_1111_1111_1111_..._1111</code></li>
</ul><p><span>From these inequalities, we can refine the range of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3805"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3806">m</span></span></span><script type="math/tex" id="MathJax-Element-432">m</script></span><br>
<span>(And wow, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3807"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3808">m</span></span></span><script type="math/tex" id="MathJax-Element-433">m</script></span><span> is uniquely obtained! I didn’t expect that!)</span></p><h3 id="Solver2" data-id="Solver"><a class="anchor hidden-xs" href="#Solver2" title="Solver2"><span class="octicon octicon-link"></span></a><span>Solver</span></h3><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># solver.py</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys

<span class="hljs-comment">#config</span>
context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'i386'</span>)
context.log_level = <span class="hljs-string">'debug'</span>

FILE_NAME = <span class="hljs-string">"./pseudo.py"</span>

<span class="hljs-comment">#"""</span>
HOST = <span class="hljs-string">"this-is-not-lsb.seccon.games"</span>
PORT = <span class="hljs-number">8080</span>
<span class="hljs-string">"""
HOST = "localhost"
PORT = 7777
#"""</span>

<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sys.argv[<span class="hljs-number">1</span>] == <span class="hljs-string">'r'</span>:
    conn = remote(HOST, PORT)
<span class="hljs-keyword">else</span>:
    conn = process([<span class="hljs-string">"python3"</span>, FILE_NAME])


n = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b' = '</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">assert</span> n.bit_length() == <span class="hljs-number">1024</span>

e = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b' = '</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">assert</span> e == <span class="hljs-number">65537</span>

flag_length = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b' = '</span>)[<span class="hljs-number">1</span>])
<span class="hljs-keyword">assert</span> flag_length == <span class="hljs-number">439</span>

c = <span class="hljs-built_in">eval</span>(conn.recvline().split(<span class="hljs-string">b' = '</span>)[<span class="hljs-number">1</span>])


<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_oracle</span>(<span class="hljs-params">payload:<span class="hljs-built_in">int</span></span>):
    conn.sendlineafter(<span class="hljs-string">b'c = '</span>, <span class="hljs-built_in">str</span>(payload).encode())
    resp = conn.recvline()
    <span class="hljs-keyword">if</span> <span class="hljs-string">b'True'</span> <span class="hljs-keyword">in</span> resp:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">elif</span> <span class="hljs-string">b'False'</span> <span class="hljs-keyword">in</span> resp:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'[-] coding error'</span>)
        <span class="hljs-keyword">assert</span> <span class="hljs-number">1</span>==<span class="hljs-number">2</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-comment"># find k_min such that</span>
<span class="hljs-comment"># (k_min - 1) * m &lt;  0b00_1111_1111_0000...</span>
<span class="hljs-comment">#  k_min      * m &gt;= 0b00_1111_1111_0000...</span>
_<span class="hljs-built_in">min</span> = (<span class="hljs-number">49</span> * <span class="hljs-number">2</span>**<span class="hljs-number">577</span>)
_<span class="hljs-built_in">max</span> = (<span class="hljs-number">49</span> * <span class="hljs-number">2</span>**<span class="hljs-number">578</span>)

<span class="hljs-keyword">while</span> _<span class="hljs-built_in">max</span> - _<span class="hljs-built_in">min</span> &gt; <span class="hljs-number">1</span>:
    _mid = (_<span class="hljs-built_in">min</span> + _<span class="hljs-built_in">max</span>) // <span class="hljs-number">2</span>
    <span class="hljs-keyword">if</span> send_oracle(c * <span class="hljs-built_in">pow</span>(_mid, e, n) % n):
        _<span class="hljs-built_in">max</span> = _mid
    <span class="hljs-keyword">else</span>:
        _<span class="hljs-built_in">min</span> = _mid
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[*] diff: <span class="hljs-subst">{_<span class="hljs-built_in">max</span> - _<span class="hljs-built_in">min</span>}</span>'</span>)

<span class="hljs-keyword">assert</span> _<span class="hljs-built_in">max</span> - _<span class="hljs-built_in">min</span> == <span class="hljs-number">1</span>
<span class="hljs-keyword">assert</span> send_oracle(c * <span class="hljs-built_in">pow</span>(_<span class="hljs-built_in">max</span>, e, n) % n)
<span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> send_oracle( c * <span class="hljs-built_in">pow</span>(_<span class="hljs-built_in">min</span>, e, n) % n)
k_min = _<span class="hljs-built_in">max</span>
val_min = (<span class="hljs-number">0xFF</span> &lt;&lt; <span class="hljs-number">1014</span>) 

<span class="hljs-comment"># find k_max such that</span>
<span class="hljs-comment">#  k_max      * m &lt;= 0b00_1111_1111_1111...</span>
<span class="hljs-comment"># (k_max + 1) * m &gt;  0b00_1111_1111_1111...</span>
_<span class="hljs-built_in">min</span> = (<span class="hljs-number">49</span> * <span class="hljs-number">2</span>**<span class="hljs-number">578</span>)
_<span class="hljs-built_in">max</span> = (<span class="hljs-number">49</span> * <span class="hljs-number">2</span>**<span class="hljs-number">579</span>)

<span class="hljs-keyword">while</span> _<span class="hljs-built_in">max</span> - _<span class="hljs-built_in">min</span> &gt; <span class="hljs-number">1</span>:
    _mid = (_<span class="hljs-built_in">min</span> + _<span class="hljs-built_in">max</span>) // <span class="hljs-number">2</span>
    <span class="hljs-keyword">if</span> send_oracle(c * <span class="hljs-built_in">pow</span>(_mid, e, n) % n):
        _<span class="hljs-built_in">min</span> = _mid
    <span class="hljs-keyword">else</span>:
        _<span class="hljs-built_in">max</span> = _mid
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[*] diff: <span class="hljs-subst">{_<span class="hljs-built_in">max</span> - _<span class="hljs-built_in">min</span>}</span>'</span>)

<span class="hljs-keyword">assert</span> _<span class="hljs-built_in">max</span> - _<span class="hljs-built_in">min</span> == <span class="hljs-number">1</span>
<span class="hljs-keyword">assert</span> send_oracle(c * <span class="hljs-built_in">pow</span>(_<span class="hljs-built_in">min</span>, e, n) % n)
<span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> send_oracle(c * <span class="hljs-built_in">pow</span>(_<span class="hljs-built_in">max</span>, e, n) % n)
k_max = _<span class="hljs-built_in">min</span>
val_max = (<span class="hljs-number">0x100</span> &lt;&lt; <span class="hljs-number">1014</span>) - <span class="hljs-number">1</span>

conn.close()
<span class="hljs-built_in">print</span>(long_to_bytes(val_min // k_min))
<span class="hljs-built_in">print</span>(long_to_bytes(val_max // k_max))
<span class="hljs-comment"># SECCON{WeLC0me_t0_tHe_MirRoR_LaNd!_tHIs_is_lSb_orAcLe!}</span>
</div></div></code></pre><h2 id="insufficient-164-pts-33-solved" data-id="insufficient-164-pts-33-solved"><a class="anchor hidden-xs" href="#insufficient-164-pts-33-solved" title="insufficient-164-pts-33-solved"><span class="octicon octicon-link"></span></a><span>insufficient (164 pts, 33 solved)</span></h2><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> getPrime, bytes_to_long
<span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> FLAG


<span class="hljs-comment"># f(x,y,z) = a1*x + a2*x^2 + a3*x^3</span>
<span class="hljs-comment">#          + b1*y + b2*y^2 + b3*y^3</span>
<span class="hljs-comment">#          + c*z + s mod p</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_f</span>(<span class="hljs-params">coeffs, x, y, z, p</span>):
    ret = <span class="hljs-number">0</span>
    ret += x * coeffs[<span class="hljs-number">0</span>] + <span class="hljs-built_in">pow</span>(x, <span class="hljs-number">2</span>, p) * coeffs[<span class="hljs-number">1</span>] + <span class="hljs-built_in">pow</span>(x, <span class="hljs-number">3</span>, p)*coeffs[<span class="hljs-number">2</span>]
    ret += y * coeffs[<span class="hljs-number">3</span>] + <span class="hljs-built_in">pow</span>(y, <span class="hljs-number">2</span>, p) * coeffs[<span class="hljs-number">4</span>] + <span class="hljs-built_in">pow</span>(y, <span class="hljs-number">3</span>, p)*coeffs[<span class="hljs-number">5</span>]
    ret += z * coeffs[<span class="hljs-number">6</span>]
    ret += coeffs[<span class="hljs-number">7</span>]

    <span class="hljs-keyword">return</span> ret % p


p = getPrime(<span class="hljs-number">512</span>)


<span class="hljs-comment"># [a1, a2, a3, b1, b2, b3, c, s]</span>
coeffs = [randint(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>**<span class="hljs-number">128</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>)]

key = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> coeff <span class="hljs-keyword">in</span> coeffs:
    key &lt;&lt;= <span class="hljs-number">128</span>
    key ^= coeff

cipher_text = bytes_to_long(FLAG) ^ key
<span class="hljs-built_in">print</span>(cipher_text)

shares = []
<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):
    x = randint(<span class="hljs-number">0</span>, p)
    y = randint(<span class="hljs-number">0</span>, p)
    z = randint(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>**<span class="hljs-number">128</span>)

    w = calc_f(coeffs, x, y, z, p)
    packed_share = ((x,y), w)
    shares.append(packed_share)

<span class="hljs-built_in">print</span>(p)
<span class="hljs-built_in">print</span>(shares)
</div></div></code></pre><h3 id="Overview3" data-id="Overview"><a class="anchor hidden-xs" href="#Overview3" title="Overview3"><span class="octicon octicon-link"></span></a><span>Overview</span></h3><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3809"><span class="MJXp-msubsup" id="MJXp-Span-3810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3811" style="margin-right: 0.05em;">W</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3812" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3813" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-msubsup" id="MJXp-Span-3814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3815" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3816" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3817"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3818" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3819" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3820" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3821"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3822" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3823" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-3824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3825" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-3827">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3826">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3828" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3829"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3830" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3831" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-3832"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3833" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-3835">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3834">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3836" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3837"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3838" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3839" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3840"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3841" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3842" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3843" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3845" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3846" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-3847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3848" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-3850">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3849">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3851" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-3852"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3853" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3854" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-3855"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3856" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-3858">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3857">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3859" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3860">c</span><span class="MJXp-msubsup" id="MJXp-Span-3861"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3862" style="margin-right: 0.05em;">z</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3863" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3864" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3865">s</span><span class="MJXp-mo" id="MJXp-Span-3866" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3867">P</span></span></span><script type="math/tex" id="MathJax-Element-434">W_i \equiv a_1X_i + a_2X_i^2 + a_3X_i^3 + b_1Y_i + b_2Y_i^2 + b_3Y_i^3 + cz_i + s \bmod P</script></span>
<ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3869">i</span><span class="MJXp-mo" id="MJXp-Span-3870" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-3871">1</span><span class="MJXp-mo" id="MJXp-Span-3872" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3873">2</span><span class="MJXp-mo" id="MJXp-Span-3874" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3875">3</span><span class="MJXp-mo" id="MJXp-Span-3876" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-3877">4</span></span></span><script type="math/tex" id="MathJax-Element-435">i = 1, 2, 3, 4</script></span></li>
</ul>
</li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3878"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3879">P</span><span class="MJXp-mo" id="MJXp-Span-3880" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3882" style="margin-right: 0.05em;">X</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3883" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-3884" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3885"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3886" style="margin-right: 0.05em;">Y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3887" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-436">P, X_i, Y_i</script></span><span>: 512 bits</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3888"><span class="MJXp-msubsup" id="MJXp-Span-3889"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3890" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3891" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3892" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3893"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3894" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3895" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3896" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3897"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3898" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3899" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-3900" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3901"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3902" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3903" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3904" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3905"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3906" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3907" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3908" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3909"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3910" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3911" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-3912" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3913">c</span><span class="MJXp-mo" id="MJXp-Span-3914" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3915">s</span><span class="MJXp-mo" id="MJXp-Span-3916" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3917"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3918" style="margin-right: 0.05em;">z</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-3919" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-437">a_1, a_2, a_3, b_1, b_2, b_3, c, s, z_i</script></span><span>: 128 bits</span></li>
</ul><p><span>The challenge is to find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-3920"><span class="MJXp-msubsup" id="MJXp-Span-3921"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3922" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3923" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3924" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3925"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3926" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3927" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3928" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3930" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3931" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-3932" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3933"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3934" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3935" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3936" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3937"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3938" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3939" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-3940" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-3941"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3942" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3943" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-3944" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3945">c</span><span class="MJXp-mo" id="MJXp-Span-3946" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3947">s</span></span></span><script type="math/tex" id="MathJax-Element-438">a_1, a_2, a_3, b_1, b_2, b_3, c, s</script></span><span> under the above conditions.</span></p><p><span>Strictly speaking, the flag is obtained by the operation of computing the </span><code>key</code><span> from these unknown variable and taking XOR, as in lines 25-31.</span></p><h3 id="Hidden-Number-Problem" data-id="Hidden-Number-Problem"><a class="anchor hidden-xs" href="#Hidden-Number-Problem" title="Hidden-Number-Problem"><span class="octicon octicon-link"></span></a><span>Hidden Number Problem</span></h3><p><span>The given conditional expression can be written as follows:</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-3948"><span class="MJXp-mrow" id="MJXp-Span-3949"><span class="MJXp-mo" id="MJXp-Span-3950" style="margin-left: 0em; margin-right: 0em; vertical-align: -1.8em;"><span style="font-size: 8.2em; margin-left: -0.394em;" class="MJXp-right MJXp-scale2">{</span></span><span class="MJXp-mtable" id="MJXp-Span-3951"><span><span class="MJXp-mtr" id="MJXp-Span-3952" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-3953" style="text-align: left;"><span class="MJXp-mo" id="MJXp-Span-3954" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3955">c</span><span class="MJXp-msubsup" id="MJXp-Span-3956"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3957" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3958" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3959" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3960">s</span><span class="MJXp-mo" id="MJXp-Span-3961" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3962" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-3963" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-3964" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-3965"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3966" style="margin-right: 0.05em;">W</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3967" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3968" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-3969" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mo" id="MJXp-Span-3970" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-3971"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3972" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3973" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3974"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3975" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3976" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-3977" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-3978"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3979" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3980" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-3981"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3982" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-3984">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-3983">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3985" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-3986"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3987" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3988" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-3989"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3990" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-3992">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-3991">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-3993" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-3994"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3995" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3996" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-3997"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3998" style="margin-right: 0.05em;">Y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-3999" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4000" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4001"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4002" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4003" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-4004"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4005" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4007">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4006">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4008" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4009"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4010" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4011" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-4012"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4013" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4015">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4014">1</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-4016">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4017" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mtext" id="MJXp-Span-4018">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4019">P</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4020" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4021" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mo" id="MJXp-Span-4022" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4023">c</span><span class="MJXp-msubsup" id="MJXp-Span-4024"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4025" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4026" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4027" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4028">s</span><span class="MJXp-mo" id="MJXp-Span-4029" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-4030" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-4031" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-4032" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4033"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4034" style="margin-right: 0.05em;">W</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4035" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4036" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-4037" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mo" id="MJXp-Span-4038" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4039"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4040" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4041" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-4042"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4043" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4044" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4045" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4046"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4047" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4048" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-4049"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4050" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4052">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4051">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4053" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4054"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4055" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4056" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-4057"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4058" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4060">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4059">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4061" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4062"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4063" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4064" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-4065"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4066" style="margin-right: 0.05em;">Y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4067" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4068" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4069"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4070" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4071" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-4072"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4073" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4075">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4074">2</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4076" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4077"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4078" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4079" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-4080"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4081" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4083">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4082">2</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-4084">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4085" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mtext" id="MJXp-Span-4086">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4087">P</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4088" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4089" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mtext" id="MJXp-Span-4090">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4091">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4092">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4093">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4094">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4095">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4096">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4097" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4098" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4099" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mo" id="MJXp-Span-4100" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4101">c</span><span class="MJXp-msubsup" id="MJXp-Span-4102"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4103" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4104" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4105" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4106">s</span><span class="MJXp-mo" id="MJXp-Span-4107" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-4108" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-4109" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-4110" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4111"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4112" style="margin-right: 0.05em;">W</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4113" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4114" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-4115" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mo" id="MJXp-Span-4116" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4118" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4119" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-4120"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4121" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4122" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4123" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4124"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4125" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4126" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-4127"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4128" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4130">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4129">4</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4131" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4133" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4134" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-4135"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4136" style="margin-right: 0.05em;">X</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4138">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4137">4</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4139" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4140"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4141" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4142" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-msubsup" id="MJXp-Span-4143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4144" style="margin-right: 0.05em;">Y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4145" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4146" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4147"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4148" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4149" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-4150"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4151" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4153">2</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4152">4</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4154" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4156" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4157" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-msubsup" id="MJXp-Span-4158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4159" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4161">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4160">4</span></span></span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-4162">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4163" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mtext" id="MJXp-Span-4164">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4165">P</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4166" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-439">\begin{cases}
(cz_1 + s) + (-W_1) \equiv -a_1X_1 - a_2X_1^2 - a_3X_1^3 - b_1Y_1 - b_2Y_1^2 - b_3Y_1^3 \ \bmod \ P \\
(cz_2 + s) + (-W_2) \equiv -a_1X_2 - a_2X_2^2 - a_3X_2^3 - b_1Y_2 - b_2Y_2^2 - b_3Y_2^3 \ \bmod \ P \\
\ \ \ \ \ \ \ \vdots \\
(cz_4 + s) + (-W_4) \equiv -a_1X_4 - a_2X_4^2 - a_3X_4^3 - b_1Y_4 - b_2Y_4^2 - b_3Y_4^3 \ \bmod \ P \\
\end{cases}</script></span></p><p><span>If we look closely, you will see that it is very similar to the HNP (Hidden Number Problem).</span></p><p><span>HNP is the problem of finding </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4167"><span class="MJXp-msubsup" id="MJXp-Span-4168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4169" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4170" style="vertical-align: -0.4em;">i</span></span></span></span><script type="math/tex" id="MathJax-Element-440">x_i</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4172">y</span></span></span><script type="math/tex" id="MathJax-Element-441">y</script></span><span> from the following </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4174">N</span></span></span><script type="math/tex" id="MathJax-Element-442">N</script></span><span> equations:</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4175"><span class="MJXp-mrow" id="MJXp-Span-4176"><span class="MJXp-mo" id="MJXp-Span-4177" style="margin-left: 0em; margin-right: 0em; vertical-align: -1.533em;"><span style="font-size: 7.133em; margin-left: -0.394em;" class="MJXp-right MJXp-scale2">{</span></span><span class="MJXp-mtable" id="MJXp-Span-4178"><span><span class="MJXp-mtr" id="MJXp-Span-4179" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4180" style="text-align: left;"><span class="MJXp-msubsup" id="MJXp-Span-4181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4182" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4183" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4184" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-4185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4186" style="margin-right: 0.05em;">B</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4187" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4188" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4189"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4190" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4191" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4192">y</span><span class="MJXp-mtext" id="MJXp-Span-4193">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4194" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mtext" id="MJXp-Span-4195">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4196">P</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4197" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4198" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-msubsup" id="MJXp-Span-4199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4200" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4201" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4202" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-4203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4204" style="margin-right: 0.05em;">B</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4205" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4206" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4207"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4208" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4209" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4210">y</span><span class="MJXp-mtext" id="MJXp-Span-4211">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4212" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mtext" id="MJXp-Span-4213">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4214">P</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4215" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4216" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mtext" id="MJXp-Span-4217">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4218">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4219">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4220">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4221">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4222">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-4223">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4224" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4225" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4226" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-msubsup" id="MJXp-Span-4227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4228" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4229" style="vertical-align: -0.4em;">N</span></span><span class="MJXp-mo" id="MJXp-Span-4230" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-4231"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4232" style="margin-right: 0.05em;">B</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4233" style="vertical-align: -0.4em;">N</span></span><span class="MJXp-mo" id="MJXp-Span-4234" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4235"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4236" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4237" style="vertical-align: -0.4em;">N</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4238">y</span><span class="MJXp-mtext" id="MJXp-Span-4239">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-4240" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mtext" id="MJXp-Span-4241">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4242">P</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4243" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-443">\begin{cases}
x_1 + B_1 = C_1y \ \bmod \ P \\
x_2 + B_2 = C_2y \ \bmod \ P \\
\ \ \ \ \ \ \ \vdots \\
x_N + B_N = C_Ny \ \bmod \ P 
\end{cases}</script></span></p><p><span>In many cases, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4244"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4245">x</span></span></span><script type="math/tex" id="MathJax-Element-444">x</script></span><span> is required to be sufficiently small compared to other known parameters.</span></p><p><span>HNP has the following form:</span></p><ul>
<li><span>Left side: (unknown) </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4246"><span class="MJXp-mo" id="MJXp-Span-4247" style="margin-left: 0.267em; margin-right: 0.267em;">+</span></span></span><script type="math/tex" id="MathJax-Element-445">+</script></span><span> (known)</span></li>
<li><span>Right side: (unknown) </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4248"><span class="MJXp-mo" id="MJXp-Span-4249" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span></span></span><script type="math/tex" id="MathJax-Element-446">\cdot</script></span><span> (known). </span><strong><span>The unknowns are the same.</span></strong></li>
</ul><p><span>In this problem, the left-hand side has the same format as the ordinary HNP, and although the number of variables on the right-hand side has increased, the rule of “reuse of unknown variables” itself is correctly obeyed.</span></p><h3 id="Construction-of-Lattice" data-id="Construction-of-Lattice"><a class="anchor hidden-xs" href="#Construction-of-Lattice" title="Construction-of-Lattice"><span class="octicon octicon-link"></span></a><span>Construction of Lattice</span></h3><p><span>For a normal HNP, the following lattice is often constructed:</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4250"><span class="MJXp-mrow" id="MJXp-Span-4251"><span class="MJXp-mo" id="MJXp-Span-4252" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">(</span></span><span class="MJXp-mtable" id="MJXp-Span-4253"><span><span class="MJXp-mtr" id="MJXp-Span-4254" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4255" style="text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4256" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4257"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4258" style="margin-right: 0.05em;">k</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4259" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4260" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4261" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4262" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4263" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4264"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4265" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4266" style="vertical-align: -0.4em;">N</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4267" style="padding-left: 1em; text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4268">y</span></span><span class="MJXp-mtd" id="MJXp-Span-4269" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4270" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-4271">1</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4272" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">)</span></span></span><span class="MJXp-mrow" id="MJXp-Span-4273"><span class="MJXp-mo" id="MJXp-Span-4274" style="margin-left: 0em; margin-right: 0em; vertical-align: -2.05em;"><span style="font-size: 9.2em; margin-left: -0.25em;" class="MJXp-right MJXp-scale2">(</span></span><span class="MJXp-mtable" id="MJXp-Span-4275"><span><span class="MJXp-mtr" id="MJXp-Span-4276" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4277" style="text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4278">P</span></span><span class="MJXp-mtd" id="MJXp-Span-4279" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4280" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4281" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4282">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4283" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4284">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4285" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4286">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4287" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4288" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4289" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4290" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4291" style="margin-left: 0.333em; margin-right: 0.333em;">⋱</span></span><span class="MJXp-mtd" id="MJXp-Span-4292" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4293" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4294" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4295">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4296" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4297">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4298" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4299" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4300">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4301" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4302" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4303" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4304">P</span></span><span class="MJXp-mtd" id="MJXp-Span-4305" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4306">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4307" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4308">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4309" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4310" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4311"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4312" style="margin-right: 0.05em;">C</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4313" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4314" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4315" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4316" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4317"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4318" style="margin-right: 0.05em;">C</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4319" style="vertical-align: -0.4em;">N</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4320" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4321"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4322" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4323" style="vertical-align: -0.4em;">0</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4324" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4325">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4326" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4327" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4328"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4329" style="margin-right: 0.05em;">B</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4330" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4331" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4332" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4333" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4334"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4335" style="margin-right: 0.05em;">B</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4336" style="vertical-align: -0.4em;">N</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4337" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4338">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4339" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4340"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4341" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4342" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4343" style="margin-left: 0em; margin-right: 0em; vertical-align: -2.05em;"><span style="font-size: 9.2em; margin-left: -0.25em;" class="MJXp-right MJXp-scale2">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-4344" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-4345"><span class="MJXp-mo" id="MJXp-Span-4346" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">(</span></span><span class="MJXp-mtable" id="MJXp-Span-4347"><span><span class="MJXp-mtr" id="MJXp-Span-4348" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4349" style="text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4351" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4352" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4353" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4354" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4355" style="padding-left: 1em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4356"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4357" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4358" style="vertical-align: -0.4em;">N</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4359" style="padding-left: 1em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4361" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4362" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4363">y</span></span><span class="MJXp-mtd" id="MJXp-Span-4364" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4365" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4366"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4367" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4368" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4369" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">)</span></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-447">
\begin{pmatrix}
-k_1 & \cdots & -k_N & y & -1
\end{pmatrix}
\begin{pmatrix}
P       &\cdots&0       &0  &0\\
\vdots  &\ddots&\vdots  &0  &0\\
0       &\cdots&P       &0  &0\\
C_1     &\cdots&C_N     &w_0&0\\
B_1     &\cdots&B_N     &0  &w_1
\end{pmatrix}=\begin{pmatrix}
x_1 & \cdots & x_N & w_0y & -w_1
\end{pmatrix}
</script></span></p><p><span>Then, set appropriate parameters (weights) for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4370"><span class="MJXp-msubsup" id="MJXp-Span-4371"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4372" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4373" style="vertical-align: -0.4em;">0</span></span></span></span><script type="math/tex" id="MathJax-Element-448">w_0</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4374"><span class="MJXp-msubsup" id="MJXp-Span-4375"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4376" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4377" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-449">w_1</script></span><span> and perform LLL-reduction on the middle matrix.</span></p><p><span>Emulating this sequence of steps, the following lattice is constructed for an “extended” HNP like the one in this challenge:</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4378"><span class="MJXp-mrow" id="MJXp-Span-4379"><span class="MJXp-mo" id="MJXp-Span-4380" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">(</span></span><span class="MJXp-mtable" id="MJXp-Span-4381"><span><span class="MJXp-mtr" id="MJXp-Span-4382" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4383" style="text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4384" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4385"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4386" style="margin-right: 0.05em;">k</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4387" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4388" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4389" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4390" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4391" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4392"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4393" style="margin-right: 0.05em;">k</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4394" style="vertical-align: -0.4em;">4</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4395" style="padding-left: 1em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4396"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4397" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4398" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4399" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4400" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4401" style="padding-left: 1em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4402"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4403" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4404" style="vertical-align: -0.4em;">3</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4405" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4406" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-4407">1</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4408" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">)</span></span></span><span class="MJXp-mrow" id="MJXp-Span-4409"><span class="MJXp-mo" id="MJXp-Span-4410" style="margin-left: 0em; margin-right: 0em; vertical-align: -3.122em;"><span style="font-size: 13.489em; margin-left: -0.29em;" class="MJXp-right MJXp-scale1">(</span></span><span class="MJXp-mtable" id="MJXp-Span-4411"><span><span class="MJXp-mtr" id="MJXp-Span-4412" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4413" style="text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4414">P</span></span><span class="MJXp-mtd" id="MJXp-Span-4415" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4416" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4417" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4418">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4419" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4420">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4421" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4422" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4423" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4424">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4425" style="padding-left: 1em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4426">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4427" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4428" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4429" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4430" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4431" style="margin-left: 0.333em; margin-right: 0.333em;">⋱</span></span><span class="MJXp-mtd" id="MJXp-Span-4432" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4433" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4434" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4435" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4436" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4437" style="margin-left: 0.333em; margin-right: 0.333em;">⋱</span></span><span class="MJXp-mtd" id="MJXp-Span-4438" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4439" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4440" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4441" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4442" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4443" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4444">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4445" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4446" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4447" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4448">P</span></span><span class="MJXp-mtd" id="MJXp-Span-4449" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4450">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4451" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4452" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4453" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4454">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4455" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4456">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4457" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4458" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4459" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4460"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4461" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4462" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4463" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4464" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4465" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4466" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4467"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4468" style="margin-right: 0.05em;">X</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4469" style="vertical-align: -0.4em;">4</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4470" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4471"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4472" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4473" style="vertical-align: -0.4em;">0</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4474" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4475" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4476" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4477">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4478" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4479">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4480" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4481" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4482" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4483" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4484" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4485" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4486" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4487" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4488" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span><span class="MJXp-mtd" id="MJXp-Span-4489" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4490" style="margin-left: 0.333em; margin-right: 0.333em;">⋱</span></span><span class="MJXp-mtd" id="MJXp-Span-4491" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4492">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4493" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4494" style="margin-left: 0.333em; margin-right: 0.333em;">⋮</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4495" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4496" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4497" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4499" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4501">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4500">1</span></span></span></span></span></span></span><span class="MJXp-mtd" id="MJXp-Span-4502" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4503" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4504" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4505" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4506"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4507" style="margin-right: 0.05em;">Y</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class="MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-4509">3</span></span></span></span><span class="MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mn" id="MJXp-Span-4508">4</span></span></span></span></span></span></span><span class="MJXp-mtd" id="MJXp-Span-4510" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4511">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4512" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4513" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4514" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4515"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4516" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4517" style="vertical-align: -0.4em;">0</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4518" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4519">0</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4520" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4521" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4523" style="margin-right: 0.05em;">W</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4524" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4525" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4526" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4527" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4528"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4529" style="margin-right: 0.05em;">W</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4530" style="vertical-align: -0.4em;">4</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4531" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4532">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4533" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4534" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4535" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-mn" id="MJXp-Span-4536">0</span></span><span class="MJXp-mtd" id="MJXp-Span-4537" style="padding-left: 1em; padding-top: 0.4em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4538"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4539" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4540" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4541" style="margin-left: 0em; margin-right: 0em; vertical-align: -3.122em;"><span style="font-size: 13.489em; margin-left: -0.29em;" class="MJXp-right MJXp-scale1">)</span></span></span><span class="MJXp-mo" id="MJXp-Span-4542" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-4543"><span class="MJXp-mo" id="MJXp-Span-4544" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">(</span></span><span class="MJXp-mtable" id="MJXp-Span-4545"><span><span class="MJXp-mtr" id="MJXp-Span-4546" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4547" style="text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4548">c</span><span class="MJXp-msubsup" id="MJXp-Span-4549"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4550" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4551" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4552" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4553">s</span></span><span class="MJXp-mtd" id="MJXp-Span-4554" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4555" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4556" style="padding-left: 1em; text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4557">c</span><span class="MJXp-msubsup" id="MJXp-Span-4558"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4559" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4560" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4561" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4562">s</span></span><span class="MJXp-mtd" id="MJXp-Span-4563" style="padding-left: 1em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4564"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4565" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4566" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-msubsup" id="MJXp-Span-4567"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4568" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4569" style="vertical-align: -0.4em;">1</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4570" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4571" style="margin-left: 0em; margin-right: 0em;">⋯</span></span><span class="MJXp-mtd" id="MJXp-Span-4572" style="padding-left: 1em; text-align: center;"><span class="MJXp-msubsup" id="MJXp-Span-4573"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4574" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4575" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-msubsup" id="MJXp-Span-4576"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4577" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4578" style="vertical-align: -0.4em;">3</span></span></span><span class="MJXp-mtd" id="MJXp-Span-4579" style="padding-left: 1em; text-align: center;"><span class="MJXp-mo" id="MJXp-Span-4580" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4581"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4582" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4583" style="vertical-align: -0.4em;">1</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-4584" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.178em;"><span style="font-size: 1.711em; margin-left: -0.01em;" class="MJXp-right MJXp-scale8">)</span></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-450">
\begin{pmatrix}
-k_1 & \cdots & -k_4 & a_1 & \cdots & b_3 & -1
\end{pmatrix}
\begin{pmatrix}
P       &\cdots&0       &0     & \cdots &     0& 0\\
\vdots  &\ddots&\vdots  &\vdots& \ddots &\vdots& \vdots\\
0       &\cdots&P       &0     & \cdots &     0& 0\\
-X_1    &\cdots&-X_4    &w_0   & \cdots &     0& 0\\
\vdots  &\cdots&\vdots  &\vdots& \ddots &     0& \vdots\\
-Y_1^3  &\cdots&-Y_4^3  &0     & \cdots &   w_0& 0\\
W_1     &\cdots&W_4     &0     & \cdots &     0& w_1\\
\end{pmatrix}=\begin{pmatrix}
cz_1+s & \cdots & cz_4+s & w_0a_1 & \cdots & w_0b_3 & -w_1
\end{pmatrix}
</script></span></p><p><span>As for the weighting, I believe it can be LLL-reduced well if all the vectors on the right side are of the same size. </span><strong><span>I have no evidence for this, lol</span></strong></p><p><span>So, in this case, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4585"><span class="MJXp-msubsup" id="MJXp-Span-4586"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4587" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4588" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-4589" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4590"><span class="MJXp-mn" id="MJXp-Span-4591" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4592" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-4593">128</span></span></span><span class="MJXp-mo" id="MJXp-Span-4594" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4595"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4596" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4597" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4598" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4599"><span class="MJXp-mn" id="MJXp-Span-4600" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4601" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-4602">256</span></span></span></span></span><script type="math/tex" id="MathJax-Element-451">w_0 = 2^{128}, w_1 = 2^{256}</script></span><span> and all the vectors on the right-hand side are adjusted to 256 bits in size.</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code">w_0 = <span class="hljs-number">2</span>**<span class="hljs-number">128</span>
w_1 = <span class="hljs-number">2</span>**<span class="hljs-number">256</span>

mat = matrix(ZZ, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):
    mat[i, i] = p
    mat[<span class="hljs-number">4</span>, i] = -shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    mat[<span class="hljs-number">5</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], <span class="hljs-number">2</span>)
    mat[<span class="hljs-number">6</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], <span class="hljs-number">3</span>)
    mat[<span class="hljs-number">7</span>, i] = -shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
    mat[<span class="hljs-number">8</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], <span class="hljs-number">2</span>)
    mat[<span class="hljs-number">9</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], <span class="hljs-number">3</span>)
    mat[<span class="hljs-number">10</span>, i] = <span class="hljs-built_in">int</span>(shares[i][<span class="hljs-number">1</span>])

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):
    mat[<span class="hljs-number">4</span>+i, <span class="hljs-number">4</span>+i] = w_0

mat[<span class="hljs-number">10</span>, <span class="hljs-number">10</span>] = w_1

M = mat.LLL()    
</div></div></code></pre><h3 id="Find-a_1-a_2-a_3-b_1-b_2-b_3" data-id="Find-a_1-a_2-a_3-b_1-b_2-b_3"><a class="anchor hidden-xs" href="#Find-a_1-a_2-a_3-b_1-b_2-b_3" title="Find-a_1-a_2-a_3-b_1-b_2-b_3"><span class="octicon octicon-link"></span></a><span>Find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4603"><span class="MJXp-msubsup" id="MJXp-Span-4604"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4605" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4606" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4607" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4608"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4609" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4610" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4611" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4612"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4613" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4614" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4615" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4616"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4617" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4618" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4619" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4620"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4621" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4622" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4623" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4624"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4625" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4626" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-452">a_1, a_2, a_3, b_1, b_2, b_3</script></span></h3><p><span>Consideration of </span><code>M</code><span> reveals the following:</span></p><ul>
<li><code>M[0][10]</code><span> matches </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4627"><span class="MJXp-msubsup" id="MJXp-Span-4628"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4629" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4630" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4631" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4632"><span class="MJXp-mn" id="MJXp-Span-4633" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4634" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-4635">256</span></span></span></span></span><script type="math/tex" id="MathJax-Element-453">w_1=2^{256}</script></span>
<ul>
<li><span>The other rows are unsuitable</span></li>
</ul>
</li>
<li><code>M[0][4]</code><span> to </span><code>M[0][9]</code><span> are all multiples of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4636"><span class="MJXp-msubsup" id="MJXp-Span-4637"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4638" style="margin-right: 0.05em;">w</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4639" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-4640" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-4641"><span class="MJXp-mn" id="MJXp-Span-4642" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4643" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-4644">128</span></span></span></span></span><script type="math/tex" id="MathJax-Element-454">w_0=2^{128}</script></span>
<ul>
<li><span>Divide them by </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4645"><span class="MJXp-msubsup" id="MJXp-Span-4646"><span class="MJXp-mn" id="MJXp-Span-4647" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4648" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-4649">128</span></span></span></span></span><script type="math/tex" id="MathJax-Element-455">2^{128}</script></span><span> to get </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4650"><span class="MJXp-msubsup" id="MJXp-Span-4651"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4652" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4653" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4654" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4656" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4657" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4658" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4660" style="margin-right: 0.05em;">a</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4661" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4662" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4663"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4664" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4665" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4666" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4667"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4668" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4669" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-456">a_1, a_2, a_3, b_1, b_2</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4670"><span class="MJXp-msubsup" id="MJXp-Span-4671"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4672" style="margin-right: 0.05em;">b</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4673" style="vertical-align: -0.4em;">3</span></span></span></span><script type="math/tex" id="MathJax-Element-457">b_3</script></span></li>
</ul>
</li>
</ul><h3 id="Find-c-and-s" data-id="Find-c-and-s"><a class="anchor hidden-xs" href="#Find-c-and-s" title="Find-c-and-s"><span class="octicon octicon-link"></span></a><span>Find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4674"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4675">c</span></span></span><script type="math/tex" id="MathJax-Element-458">c</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4677">s</span></span></span><script type="math/tex" id="MathJax-Element-459">s</script></span></h3><p><span>Let </span><code>M[0][0]</code><span>, …, </span><code>M[0][3]</code><span> be </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4678"><span class="MJXp-msubsup" id="MJXp-Span-4679"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4680" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4681" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4682" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4684" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4685" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4686" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4687"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4688" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4689" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4690" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-4691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4692" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4693" style="vertical-align: -0.4em;">4</span></span></span></span><script type="math/tex" id="MathJax-Element-460">M_1, M_2, M_3, M_4</script></span><span>.</span></p><p><span>How do we get </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4694"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4695">c</span></span></span><script type="math/tex" id="MathJax-Element-461">c</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4696"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4697">s</span></span></span><script type="math/tex" id="MathJax-Element-462">s</script></span><span> from the following?</span></p><ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4698"><span class="MJXp-msubsup" id="MJXp-Span-4699"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4700" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4701" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4702" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4703">c</span><span class="MJXp-msubsup" id="MJXp-Span-4704"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4705" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4706" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4707" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4708">s</span></span></span><script type="math/tex" id="MathJax-Element-463">M_1 = cz_1 + s</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4709"><span class="MJXp-msubsup" id="MJXp-Span-4710"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4711" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4712" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4713" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4714">c</span><span class="MJXp-msubsup" id="MJXp-Span-4715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4716" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4717" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4718" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4719">s</span></span></span><script type="math/tex" id="MathJax-Element-464">M_2 = cz_2 + s</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4720"><span class="MJXp-msubsup" id="MJXp-Span-4721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4722" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4723" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4724" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4725">c</span><span class="MJXp-msubsup" id="MJXp-Span-4726"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4727" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4728" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4729" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4730">s</span></span></span><script type="math/tex" id="MathJax-Element-465">M_3 = cz_3 + s</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4731"><span class="MJXp-msubsup" id="MJXp-Span-4732"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4733" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4734" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4735" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4736">c</span><span class="MJXp-msubsup" id="MJXp-Span-4737"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4738" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4739" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-4740" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4741">s</span></span></span><script type="math/tex" id="MathJax-Element-466">M_4 = cz_4 + s</script></span></li>
</ul><p><span>The answer is very simple.</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4742"><span class="MJXp-msubsup" id="MJXp-Span-4743"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4744" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4745" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4746" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4747"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4748" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4749" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4750" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4751">c</span><span class="MJXp-mo" id="MJXp-Span-4752" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-4753"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4754" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4755" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4756" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4757"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4758" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4759" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-4760" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-467">M_1 - M_2 = c(z_1 - z_2)</script></span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4761"><span class="MJXp-msubsup" id="MJXp-Span-4762"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4763" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4764" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4765" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4766"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4767" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4768" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4769" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4770">c</span><span class="MJXp-mo" id="MJXp-Span-4771" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-4772"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4773" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4774" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4775" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-msubsup" id="MJXp-Span-4776"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4777" style="margin-right: 0.05em;">z</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4778" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-4779" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-468">M_1 - M_3 = c(z_1 - z_3)</script></span></p><p><span>so computing the GCD of them leads to </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4780"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4781">c</span></span></span><script type="math/tex" id="MathJax-Element-469">c</script></span><span>.</span></p><p><span>And then, the following equation holds:</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4782"><span class="MJXp-msubsup" id="MJXp-Span-4783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4784" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4785" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-4786" style="margin-left: 0.333em; margin-right: 0.333em;">≡</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4787">s</span><span class="MJXp-mo" id="MJXp-Span-4788" style="margin-left: 0.278em; margin-right: 0.278em;">mod</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4789">c</span></span></span><script type="math/tex; mode=display" id="MathJax-Element-470">M_1 \equiv s \bmod c</script></span></p><p><span>Note that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4790"><span class="MJXp-msubsup" id="MJXp-Span-4791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4792" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4793" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-471">M_1</script></span><span> is 256 bits, and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4794"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4795">s</span></span></span><script type="math/tex" id="MathJax-Element-472">s</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4796"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4797">c</span></span></span><script type="math/tex" id="MathJax-Element-473">c</script></span><span> are 128 bits.</span><br>
<span>The remainder of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4798"><span class="MJXp-msubsup" id="MJXp-Span-4799"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4800" style="margin-right: 0.05em;">M</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4801" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-474">M_1</script></span><span> divided by </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4802"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4803">c</span></span></span><script type="math/tex" id="MathJax-Element-475">c</script></span><span> is </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4804"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4805">s</span></span></span><script type="math/tex" id="MathJax-Element-476">s</script></span><span>.</span></p><h3 id="Solver3" data-id="Solver"><a class="anchor hidden-xs" href="#Solver3" title="Solver3"><span class="octicon octicon-link"></span></a><span>Solver</span></h3><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># solver.sage</span>
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes

cipher = <span class="hljs-number">115139400156559163067983730101733651044517302092738415230761576068368627143021367186957088381449359016008152481518188727055259259438853550911696408473202582626669824350180493062986420292176306828782792330214492239993109523633165689080824380627230327245751549253757852668981573771168683865251547238022125676591</span>
p = <span class="hljs-number">8200291410122039687250292442109878676753589397818032770561720051299309477271228768886216860911120846659270343793701939593802424969673253182414886645533851</span>
shares = [((<span class="hljs-number">6086926015098867242735222866983726204461220951103360009696454681019399690511733951569533187634005519163004817081362909518890288475814570715924211956186561</span>, <span class="hljs-number">180544606207615749673679003486920396349643373592065733048594170223181990080540522443341611038923128944258091068067227964575144365802736335177084131200721</span>), <span class="hljs-number">358596622670209028757821020375422468786000283337112662091012759053764980353656144756495576189654506534688021724133853284750462313294554223173599545023200</span>), ((<span class="hljs-number">1386358358863317578119640490115732907593775890728347365516358215967843845703994105707232051642221482563536659365469364255206757315665759154598917141827974</span>, <span class="hljs-number">4056544903690651970564657683645824587566358589111269611317182863269566520886711060942678307985575546879523617067909465838713131842847785502375410189119098</span>), <span class="hljs-number">7987498083862441578197078091675653094495875014017487290616050579537158854070043336559221536943501617079375762641137734054184462590583526782938983347248670</span>), ((<span class="hljs-number">656537687734778409273502324331707970697362050871244803755641285452940994603617400730910858122669191686993796208644537023001462145198921682454359699163851</span>, <span class="hljs-number">7168506530157948082373212337047037955782714850395068869680326068416218527056283262697351993204957096383236610668826321537260018440150283660410281255549702</span>), <span class="hljs-number">1047085825033120721880384312942308021912742666478829834943737959325181775143075576517355925753610902886229818331095595005460339857743811544053574078662507</span>), ((<span class="hljs-number">5258797924027715460925283932681628978641108698338452367217155856384763787158334845391544834908979711067046042420593321638221507208614929195171831766268954</span>, <span class="hljs-number">4425317882205634741873988391516678208287005927456949928854593454650522868601946818897817646576217811686765487183061848994765729348913592238613989095356071</span>), <span class="hljs-number">866086803634294445156445022661535120113351818468169243952864826652249446764789342099913962106165135623940932785868082548653702309009757035399759882130676</span>)]


w_0 = <span class="hljs-number">2</span>**<span class="hljs-number">128</span>
w_1 = <span class="hljs-number">2</span>**<span class="hljs-number">256</span>

mat = matrix(ZZ, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>)
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):
    mat[i, i] = p
    mat[<span class="hljs-number">4</span>, i] = -shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
    mat[<span class="hljs-number">5</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], <span class="hljs-number">2</span>)
    mat[<span class="hljs-number">6</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], <span class="hljs-number">3</span>)
    mat[<span class="hljs-number">7</span>, i] = -shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]
    mat[<span class="hljs-number">8</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], <span class="hljs-number">2</span>)
    mat[<span class="hljs-number">9</span>, i] = -<span class="hljs-built_in">pow</span>(shares[i][<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], <span class="hljs-number">3</span>)
    mat[<span class="hljs-number">10</span>, i] = <span class="hljs-built_in">int</span>(shares[i][<span class="hljs-number">1</span>])

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):
    mat[<span class="hljs-number">4</span>+i, <span class="hljs-number">4</span>+i] = w_0

mat[<span class="hljs-number">10</span>, <span class="hljs-number">10</span>] = w_1

M = mat.LLL()    

<span class="hljs-comment"># find a1, a2, a3, b1, b2 and b3</span>
coeffs = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>, <span class="hljs-number">10</span>):
	<span class="hljs-keyword">assert</span> <span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][i]) % w_0 == <span class="hljs-number">0</span>
	coeffs.append(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][i]) // w_0))

<span class="hljs-keyword">assert</span> <span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][<span class="hljs-number">10</span>]) == w_1

m_1 = <span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])
m_2 = <span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>])
m_3 = <span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>])
m_4 = <span class="hljs-built_in">int</span>(M[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>])

c = GCD(m_1 - m_2, m_1 - m_3)
<span class="hljs-keyword">assert</span> <span class="hljs-built_in">int</span>(c).bit_length() == <span class="hljs-number">128</span>

s = <span class="hljs-built_in">int</span>(m_1 % c)
<span class="hljs-keyword">assert</span> <span class="hljs-built_in">int</span>(s + c).bit_length() &gt; <span class="hljs-number">128</span>

coeffs.append(c)
coeffs.append(s)

key = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> coeff <span class="hljs-keyword">in</span> coeffs:
    key &lt;&lt;= <span class="hljs-number">128</span>
    key ^^= coeff

<span class="hljs-built_in">print</span>(long_to_bytes(key ^^ cipher))
<span class="hljs-comment"># SECCON{Unfortunately_I_could_not_come_up_with_a_more_difficult_problem_than_last_year_sorry...-6fc18307d3ed2e7673a249abc2e0e22c}</span>
</div></div></code></pre><h2 id="witches_symmetric_exam-197-pts-22-solved" data-id="witches_symmetric_exam-197-pts-22-solved"><a class="anchor hidden-xs" href="#witches_symmetric_exam-197-pts-22-solved" title="witches_symmetric_exam-197-pts-22-solved"><span class="octicon octicon-link"></span></a><span>witches_symmetric_exam (197 pts, 22 solved)</span></h2><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> get_random_bytes
<span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad
<span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag, secret_spell

key = get_random_bytes(<span class="hljs-number">16</span>)
nonce = get_random_bytes(<span class="hljs-number">16</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>():
    data = secret_spell
    gcm_cipher = AES.new(key, AES.MODE_GCM, nonce=nonce)
    gcm_ciphertext, gcm_tag = gcm_cipher.encrypt_and_digest(data)

    ofb_input = pad(gcm_tag + gcm_cipher.nonce + gcm_ciphertext, <span class="hljs-number">16</span>)

    ofb_iv = get_random_bytes(<span class="hljs-number">16</span>)
    ofb_cipher = AES.new(key, AES.MODE_OFB, iv=ofb_iv)
    ciphertext = ofb_cipher.encrypt(ofb_input)
    <span class="hljs-keyword">return</span> ofb_iv + ciphertext


<span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">data</span>):
    ofb_iv = data[:<span class="hljs-number">16</span>]
    ofb_ciphertext = data[<span class="hljs-number">16</span>:]
    ofb_cipher = AES.new(key, AES.MODE_OFB, iv=ofb_iv)

    <span class="hljs-keyword">try</span>:
        m = ofb_cipher.decrypt(ofb_ciphertext)
        temp = unpad(m, <span class="hljs-number">16</span>)
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">b"ofb error"</span>

    <span class="hljs-keyword">try</span>:
        gcm_tag = temp[:<span class="hljs-number">16</span>]
        gcm_nonce = temp[<span class="hljs-number">16</span>:<span class="hljs-number">32</span>]
        gcm_ciphertext = temp[<span class="hljs-number">32</span>:]
        gcm_cipher = AES.new(key, AES.MODE_GCM, nonce=gcm_nonce)

        plaintext = gcm_cipher.decrypt_and_verify(gcm_ciphertext, gcm_tag)
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">b"gcm error"</span>

    <span class="hljs-keyword">if</span> <span class="hljs-string">b"give me key"</span> == plaintext:
        your_spell = <span class="hljs-built_in">input</span>(<span class="hljs-string">"ok, please say secret spell:"</span>).encode()
        <span class="hljs-keyword">if</span> your_spell == secret_spell:
            <span class="hljs-keyword">return</span> flag
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">b"Try Harder"</span>

    <span class="hljs-keyword">return</span> <span class="hljs-string">b"ok"</span>


<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ciphertext: <span class="hljs-subst">{encrypt().<span class="hljs-built_in">hex</span>()}</span>"</span>)
<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    c = <span class="hljs-built_in">input</span>(<span class="hljs-string">"ciphertext: "</span>)
    <span class="hljs-built_in">print</span>(decrypt(<span class="hljs-built_in">bytes</span>.fromhex(c)))
</div></div></code></pre><h3 id="Overview4" data-id="Overview"><a class="anchor hidden-xs" href="#Overview4" title="Overview4"><span class="octicon octicon-link"></span></a><span>Overview</span></h3><p><span>See the encryption flowchart below.</span></p><p><img src="https://i.imgur.com/mKyNQmd.png" alt="" loading="lazy"></p><ul>
<li><span>Purple: </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4807">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4808">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4809">M</span></span></span><script type="math/tex" id="MathJax-Element-477">GCM</script></span><span> encryption.</span></li>
<li><span>Red: input</span></li>
<li><span>Green: output of the </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4810"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4811">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4812">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4813">M</span></span></span><script type="math/tex" id="MathJax-Element-478">GCM</script></span></li>
<li><span>Yellow: the final output.</span></li>
<li><span>Blue: algorithm</span>
<ul>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4814"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4815">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4816">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4817">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4818">r</span></span></span><script type="math/tex" id="MathJax-Element-479">Incr</script></span><span>: Increment</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4819"><span class="MJXp-msubsup" id="MJXp-Span-4820"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4821" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4822" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-480">E_k</script></span><span>: Block cipher encryptioon using key </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4823"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4824">k</span></span></span><script type="math/tex" id="MathJax-Element-481">k</script></span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4825"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4826">Z</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4827">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4828">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4829">o</span><span class="MJXp-mtext" id="MJXp-Span-4830">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4831">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4832">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4833">d</span></span></span><script type="math/tex" id="MathJax-Element-482">Zero\ Pad</script></span><span>: Padding to 16 bytes by adding </span><code>\x00</code><span> at the end</span>
<ul>
<li><span>Note that this is different from PKCS#7 padding.</span></li>
</ul>
</li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4834"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4835">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4836">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4837">D</span></span></span><script type="math/tex" id="MathJax-Element-483">PAD</script></span><span>: PKCS#7 padding</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4838"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4839">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4840">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4841">t</span><span class="MJXp-mtext" id="MJXp-Span-4842">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4843">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4844">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4845">f</span></span></span><script type="math/tex" id="MathJax-Element-484">Cut\ Off</script></span><span>: Adjust the length to be the same as the last block of input (</span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4846"><span class="MJXp-msubsup" id="MJXp-Span-4847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4848" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-4849" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-485">m_2</script></span><span>)</span></li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4850"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4851">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4852">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4853">l</span><span class="MJXp-msubsup" id="MJXp-Span-4854"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4855" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4856" style="vertical-align: -0.4em;">H</span></span></span></span><script type="math/tex" id="MathJax-Element-486">mult_H</script></span><span>:</span>
<ul>
<li><strong><span>Don’t worry about it too much</span></strong></li>
</ul>
</li>
<li><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4857"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4858">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4859">H</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4860">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4861">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4862">H</span></span></span><script type="math/tex" id="MathJax-Element-487">GHASH</script></span>
<ul>
<li><strong><span>Don’t worry about it too much</span></strong></li>
</ul>
</li>
</ul>
</li>
</ul><p><span>(Many other writeups implement </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4863"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4864">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4865">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4866">l</span><span class="MJXp-msubsup" id="MJXp-Span-4867"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4868" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4869" style="vertical-align: -0.4em;">H</span></span></span></span><script type="math/tex" id="MathJax-Element-488">mult_H</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4870"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4871">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4872">H</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4873">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4874">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4875">H</span></span></span><script type="math/tex" id="MathJax-Element-489">GHASH</script></span><span> by themselves, but this challenge can also be solved in other ways.)</span></p><p><span>The challenge is:</span></p><ul>
<li><span>First the ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4876"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4877">C</span></span></span><script type="math/tex" id="MathJax-Element-490">C</script></span><span> for some message </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4878"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4879">m</span></span></span><script type="math/tex" id="MathJax-Element-491">m</script></span><span> is given</span></li>
<li><span>Access to an decryption oracle is allowed. The decryption result is not returned. Instead, returns:</span>
<ul>
<li><code>ofb error</code><span> if the inverse computation of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4880"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4881">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4882">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4883">D</span></span></span><script type="math/tex" id="MathJax-Element-492">PAD</script></span><span> in the lower right corner of the figure cannot be performed (i.e., PKCS#7 padding error).</span></li>
<li><code>gcm error</code><span> if </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4884"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4885">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4886">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4887">g</span></span></span><script type="math/tex" id="MathJax-Element-493">tag</script></span><span> is an invalid one.</span></li>
<li><code>ok</code><span> if the ciphertext can be decrypted correctly.</span></li>
</ul>
</li>
<li><span>Find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4888"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4889">m</span></span></span><script type="math/tex" id="MathJax-Element-494">m</script></span><span> and ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4890"><span class="MJXp-msubsup" id="MJXp-Span-4891"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4892" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4893" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4894">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4895">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4896">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4897">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4898">e</span></span></span></span></span><script type="math/tex" id="MathJax-Element-495">c_{forge}</script></span><span> for plaintext </span><code>give me key</code></li>
</ul><h3 id="Padding-Oracle-Attack" data-id="Padding-Oracle-Attack"><a class="anchor hidden-xs" href="#Padding-Oracle-Attack" title="Padding-Oracle-Attack"><span class="octicon octicon-link"></span></a><span>Padding Oracle Attack</span></h3><ul>
<li><span>The decrypted plaintext itself is not known, but it is known whether the decryption is successful or not</span></li>
<li><span>PKCS#7 padding check is involved.</span></li>
</ul><p><span>Under these conditions, “Padding Oracle Attack” can be used.</span></p><p><span>Many other explanatory articles for “Padding Oracle Attack” exist, so details are omitted.</span><br>
<span>(And for those who tackle such a difficult challenge, the implementation of it should be a piece of cake!)</span></p><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *

HOST = <span class="hljs-string">"witches-symmetric-exam.seccon.games"</span>
PORT = <span class="hljs-number">8080</span>
conn = remote(HOST, PORT)

<span class="hljs-comment"># omitted</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_oracle</span>(<span class="hljs-params">payload</span>):
    <span class="hljs-keyword">pass</span>
    
<span class="hljs-comment"># padding oracle attack</span>
<span class="hljs-comment"># return palintext of c[-16:]</span>
<span class="hljs-comment"># (note: c includes IV)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_ofb</span>(<span class="hljs-params">c</span>):
    <span class="hljs-comment"># in aes-ofb, if IV is the same, then m[-16:] ^ c[-16:] = const.</span>
    <span class="hljs-comment"># "stack" stores this constant value</span>
    stack = []
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
            <span class="hljs-comment"># change last 16 bytes (i.e., last block) into `\x00...\x00` + i + KNOWN_BYTES</span>
            <span class="hljs-comment"># KNOW_BYTES is computed based on "stack" so that the padding is appropriate</span>
            payload = c[:-<span class="hljs-number">16</span>]
            payload += <span class="hljs-string">b'\x00'</span> * (<span class="hljs-number">15</span> - <span class="hljs-built_in">len</span>(stack))
            payload += long_to_bytes(i)
            payload += <span class="hljs-string">b''</span>.join([long_to_bytes(_ ^ (<span class="hljs-built_in">len</span>(stack) + <span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> stack])  <span class="hljs-comment"># KNOW_BYTES</span>
            <span class="hljs-keyword">if</span> send_oracle(payload):
                stack = [i ^ (<span class="hljs-built_in">len</span>(stack) + <span class="hljs-number">1</span>)] + stack
                <span class="hljs-keyword">break</span>
    
    <span class="hljs-comment"># return (const.) ^ c[-16:]</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">b''</span>.join([long_to_bytes(i ^ j) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(stack, c[-<span class="hljs-number">16</span>:])])

<span class="hljs-comment"># given ciphertext</span>
c = ...

c_2 = unpad(decrypt_ofb(c), <span class="hljs-number">16</span>)
c_1 = decrypt_ofb(c[:<span class="hljs-number">64</span>])
nonce = decrypt_ofb(c[:<span class="hljs-number">48</span>])
tag = decrypt_ofb(c[:<span class="hljs-number">32</span>])
</div></div></code></pre><p><span>Derivatively, by running </span><code>decrypt_ofb(M + b'\x00' * 16)</code><span> on the part of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4899"><span class="MJXp-msubsup" id="MJXp-Span-4900"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4901" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4902" style="vertical-align: -0.4em;">k</span></span></span></span><script type="math/tex" id="MathJax-Element-496">E_k</script></span><span> in the above figure, we find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4903"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4904">c</span></span></span><script type="math/tex" id="MathJax-Element-497">c</script></span><span> such that </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4905"><span class="MJXp-msubsup" id="MJXp-Span-4906"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4907" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4908" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-4909" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4910">M</span><span class="MJXp-mo" id="MJXp-Span-4911" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-4912" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4913">c</span></span></span><script type="math/tex" id="MathJax-Element-498">E_k(M) = c</script></span><span>.</span></p><p><span>In other words, we can now perform an </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4914"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4915">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4916">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4917">B</span></span></span><script type="math/tex" id="MathJax-Element-499">ECB</script></span><span> encryption operation on any plaintext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4918"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4919">m</span></span></span><script type="math/tex" id="MathJax-Element-500">m</script></span><span> while key </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4920"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4921">k</span></span></span><script type="math/tex" id="MathJax-Element-501">k</script></span><span> remains unknown.</span></p><h3 id="GCM-Analysis-Part-1" data-id="GCM-Analysis-Part-1"><a class="anchor hidden-xs" href="#GCM-Analysis-Part-1" title="GCM-Analysis-Part-1"><span class="octicon octicon-link"></span></a><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4922"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4923">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4924">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4925">M</span></span></span><script type="math/tex" id="MathJax-Element-502">GCM</script></span><span> Analysis Part 1.</span></h3><p><span>We will look at the details of the purple </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4926"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4927">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4928">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4929">M</span></span></span><script type="math/tex" id="MathJax-Element-503">GCM</script></span><span>.</span></p><p><img src="https://i.imgur.com/CDam1lx.png" alt="" loading="lazy"></p><p><span>First, decrypt the given </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4930"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4931">C</span></span></span><script type="math/tex" id="MathJax-Element-504">C</script></span><span> and find </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4932"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4933">m</span></span></span><script type="math/tex" id="MathJax-Element-505">m</script></span><span> (i.e., </span><code>secret_spell</code><span>).</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4934"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4935">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4936">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4937">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4938">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4939">e</span></span></span><script type="math/tex" id="MathJax-Element-506">nonce</script></span><span> is known by using above Padding Oracke Attack, but the value of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4940"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4941">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4942">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4943">r</span><span class="MJXp-mtext" id="MJXp-Span-4944">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-4945">0</span></span></span><script type="math/tex" id="MathJax-Element-507">Ctr \ 0</script></span><span> is unknown.</span></p><p><span>Now, </span><a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode#Mathematical_basis" target="_blank" rel="noopener"><span>Wikipedia</span></a><span> has the following description:</span></p><blockquote>
<p><span>If the length of the IV is not 96, the GHASH function is used to calculate Counter 0:</span><br>
<span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-4946"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4947">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4948">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4949">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4950">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4951">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4952">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4953">r</span><span class="MJXp-mn" id="MJXp-Span-4954">0</span><span class="MJXp-mo" id="MJXp-Span-4955" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-4956"><span class="MJXp-mo" id="MJXp-Span-4957" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.744em;"><span style="font-size: 3.978em; margin-left: -0.278em;" class="MJXp-right MJXp-scale4">{</span></span><span class="MJXp-mtable" id="MJXp-Span-4958"><span><span class="MJXp-mtr" id="MJXp-Span-4959" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4960" style="text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4961">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4962">V</span><span class="MJXp-mtext" id="MJXp-Span-4963">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-4964"><span class="MJXp-mo" id="MJXp-Span-4965" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-4966"><span class="MJXp-mo" id="MJXp-Span-4967" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-4968">&nbsp;</span><span class="MJXp-msubsup" id="MJXp-Span-4969"><span class="MJXp-mn" id="MJXp-Span-4970" style="margin-right: 0.05em;">0</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-4971" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-4972">31</span></span></span><span class="MJXp-mtext" id="MJXp-Span-4973">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-4974"><span class="MJXp-mo" id="MJXp-Span-4975" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-4976"><span class="MJXp-mo" id="MJXp-Span-4977" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-4978">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-4979">1</span><span class="MJXp-mspace" id="MJXp-Span-4980" style="width: 15.3em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-4981">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-4982"><span class="MJXp-mi" id="MJXp-Span-4983">f</span><span class="MJXp-mi" id="MJXp-Span-4984">o</span><span class="MJXp-mi" id="MJXp-Span-4985">r</span></span><span class="MJXp-mtext" id="MJXp-Span-4986">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4987">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4988">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4989">n</span><span class="MJXp-mo" id="MJXp-Span-4990" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4991">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4992">V</span><span class="MJXp-mo" id="MJXp-Span-4993" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-4994" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-4995">96</span></span></span><span class="MJXp-mtr" id="MJXp-Span-4996" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-4997" style="padding-top: 0.2em; text-align: left;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4998">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4999">H</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5000">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5001">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5002">H</span><span class="MJXp-mo" id="MJXp-Span-5003" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5004">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5005">V</span><span class="MJXp-mtext" id="MJXp-Span-5006">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-5007"><span class="MJXp-mo" id="MJXp-Span-5008" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-5009"><span class="MJXp-mo" id="MJXp-Span-5010" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-5011">&nbsp;</span><span class="MJXp-msubsup" id="MJXp-Span-5012"><span class="MJXp-mn" id="MJXp-Span-5013" style="margin-right: 0.05em;">0</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-5014" style="vertical-align: 0.5em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-5015">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-5016"><span class="MJXp-mo" id="MJXp-Span-5017" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-5018"><span class="MJXp-mo" id="MJXp-Span-5019" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-5020">&nbsp;</span><span class="MJXp-msubsup" id="MJXp-Span-5021"><span class="MJXp-mn" id="MJXp-Span-5022" style="margin-right: 0.05em;">0</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-5023" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-5024">64</span></span></span><span class="MJXp-mtext" id="MJXp-Span-5025">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-5026"><span class="MJXp-mo" id="MJXp-Span-5027" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mrow" id="MJXp-Span-5028"><span class="MJXp-mo" id="MJXp-Span-5029" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-5030">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5031">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5032">e</span><span class="MJXp-msubsup" id="MJXp-Span-5033"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5034" style="margin-right: 0.05em;">n</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-5035" style="vertical-align: -0.4em;"><span class="MJXp-mn" id="MJXp-Span-5036">64</span></span></span><span class="MJXp-mo" id="MJXp-Span-5037" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5038">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5039">V</span><span class="MJXp-mo" id="MJXp-Span-5040" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-5041" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mtext" id="MJXp-Span-5042">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-5043">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-5044"><span class="MJXp-mi" id="MJXp-Span-5045">w</span><span class="MJXp-mi" id="MJXp-Span-5046">i</span><span class="MJXp-mi" id="MJXp-Span-5047">t</span><span class="MJXp-mi" id="MJXp-Span-5048">h</span><span class="MJXp-mtext" id="MJXp-Span-5049">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-5050" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-5051" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-5052" style="margin-left: 0em; margin-right: 0.222em;">.</span></span><span class="MJXp-mtext" id="MJXp-Span-5053">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-5054">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-5055">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-5056">&nbsp;</span><span class="MJXp-mtext" id="MJXp-Span-5057">&nbsp;</span><span class="MJXp-mrow" id="MJXp-Span-5058"><span class="MJXp-mi" id="MJXp-Span-5059">o</span><span class="MJXp-mi" id="MJXp-Span-5060">t</span><span class="MJXp-mi" id="MJXp-Span-5061">h</span><span class="MJXp-mi" id="MJXp-Span-5062">e</span><span class="MJXp-mi" id="MJXp-Span-5063">r</span><span class="MJXp-mi" id="MJXp-Span-5064">w</span><span class="MJXp-mi" id="MJXp-Span-5065">i</span><span class="MJXp-mi" id="MJXp-Span-5066">s</span><span class="MJXp-mi" id="MJXp-Span-5067">e</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-5068" style="margin-left: 0em; margin-right: 0em;"></span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-508">Counter0 = \begin{cases}
IV\ ||\ 0^{31} \ ||\ 1 \hspace{153pt} \ {\rm for} \ len(IV) = 96\\
GHASH(IV \ || \ 0^s \ ||\ 0^{64} \ || \ len_{64}(IV)) \ \ {\rm with \ ...} \ \ \  \ \ {\rm otherwise}
\end{cases}
</script></span></p>
</blockquote><p><span>and it is implemented on </span><a href="https://github.com/Legrandin/pycryptodome/blob/master/lib/Crypto/Cipher/_mode_gcm.py#L221" target="_blank" rel="noopener"><span>line 221</span></a><span> of </span><code>Crypto/Cipher/_mode_gcm.py</code><span> in pycryptodome:</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L221~</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, factory, key, nonce, mac_len, cipher_params, ghash_c</span>):
        ...
        
        <span class="hljs-comment"># Step 1 in SP800-38D, Algorithm 4 (encryption) - Compute H</span>
        <span class="hljs-comment"># See also Algorithm 5 (decryption)</span>
        hash_subkey = factory.new(key,
                                  self._factory.MODE_ECB,
                                  **cipher_params
                                  ).encrypt(<span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)

        <span class="hljs-comment"># Step 2 - Compute J0</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.nonce) == <span class="hljs-number">12</span>:
            j0 = self.nonce + <span class="hljs-string">b"\x00\x00\x00\x01"</span>
        <span class="hljs-keyword">else</span>:
            fill = (<span class="hljs-number">16</span> - (<span class="hljs-built_in">len</span>(nonce) % <span class="hljs-number">16</span>)) % <span class="hljs-number">16</span> + <span class="hljs-number">8</span>
            ghash_in = (self.nonce +
                        <span class="hljs-string">b'\x00'</span> * fill +
                        long_to_bytes(<span class="hljs-number">8</span> * <span class="hljs-built_in">len</span>(nonce), <span class="hljs-number">8</span>))
            j0 = _GHASH(hash_subkey, ghash_c).update(ghash_in).digest()
</code></pre><p><span>This shows that:</span></p><ul>
<li><code>j0</code><span> corresponds to </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5069"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5070">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5071">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5072">r</span><span class="MJXp-mtext" id="MJXp-Span-5073">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5074">0</span></span></span><script type="math/tex" id="MathJax-Element-509">Ctr\ 0</script></span><span> in above figure.</span></li>
<li><code>hash_subkey</code><span> is the ECB-encrypted value of 0 (i.e., </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5075"><span class="MJXp-msubsup" id="MJXp-Span-5076"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5077" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-5078" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-5079" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-5080">0</span><span class="MJXp-mo" id="MJXp-Span-5081" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><script type="math/tex" id="MathJax-Element-510">E_k(0)</script></span><span>).</span>
<ul>
<li><span>Note that it depends on key </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5082"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5083">k</span></span></span><script type="math/tex" id="MathJax-Element-511">k</script></span><span>, but it can be calculated by </span><code>decrypt_ofb(b'\x00' * 32)</code></li>
</ul>
</li>
</ul><p><span>So, let’s modify </span><code>Crypto/Cipher/_mode_gcm.py</code><span> by implementing a function that computes the </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5084"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5085">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5086">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5087">r</span><span class="MJXp-mtext" id="MJXp-Span-5088">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5089">0</span></span></span><script type="math/tex" id="MathJax-Element-512">Ctr \ 0</script></span><span> used in the challenge server.</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L261~</span>
    <span class="hljs-comment"># add your own function</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_target_j0</span>(<span class="hljs-params">self, target_hash_subkey</span>):
        fill = (<span class="hljs-number">16</span> - (<span class="hljs-built_in">len</span>(self.nonce) % <span class="hljs-number">16</span>)) % <span class="hljs-number">16</span> + <span class="hljs-number">8</span>
        ghash_in = (self.nonce +
                    <span class="hljs-string">b'\x00'</span> * fill +
                    long_to_bytes(<span class="hljs-number">8</span> * <span class="hljs-built_in">len</span>(self.nonce), <span class="hljs-number">8</span>))
        <span class="hljs-keyword">return</span> _GHASH(target_hash_subkey, self._ghash_c).update(ghash_in).digest()
</code></pre><p><span>If </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5090"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5091">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5092">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5093">r</span><span class="MJXp-mn" id="MJXp-Span-5094">0</span></span></span><script type="math/tex" id="MathJax-Element-513">Ctr 0</script></span><span>(i.e., </span><code>j0</code><span>) is known, then naturally </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5095"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5096">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5097">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5098">r</span><span class="MJXp-mtext" id="MJXp-Span-5099">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5100">1</span></span></span><script type="math/tex" id="MathJax-Element-514">Ctr\ 1</script></span><span> are also obtained.</span></p><p><span>Since </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5101"><span class="MJXp-msubsup" id="MJXp-Span-5102"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5103" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5104" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-515">c_1</script></span><span> in the figure are also known by Padding Oracle Attack, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5105"><span class="MJXp-msubsup" id="MJXp-Span-5106"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5107" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5108" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-516">m_1</script></span><span> can be obtained by</span></p><p><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-5109"><span class="MJXp-msubsup" id="MJXp-Span-5110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5111" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-5112" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-5113" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5114">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5115">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5116">r</span><span class="MJXp-mtext" id="MJXp-Span-5117">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5118">1</span><span class="MJXp-mo" id="MJXp-Span-5119" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-5120" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-5121"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5122" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5123" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-5124" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span><span class="MJXp-msubsup" id="MJXp-Span-5125"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5126" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5127" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-517">E_k(Ctr\ 1) = m_1 \oplus c_1</script></span></p><p><span>The same is true for </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5128"><span class="MJXp-msubsup" id="MJXp-Span-5129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5130" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5131" style="vertical-align: -0.4em;">2</span></span></span></span><script type="math/tex" id="MathJax-Element-518">m_2</script></span><span>, and finally </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5133">m</span></span></span><script type="math/tex" id="MathJax-Element-519">m</script></span><span> is decrypted!</span></p><h3 id="Solver-Part-1" data-id="Solver-Part-1"><a class="anchor hidden-xs" href="#Solver-Part-1" title="Solver-Part-1"><span class="octicon octicon-link"></span></a><span>Solver Part 1.</span></h3><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># solver_part1.py</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES

<span class="hljs-comment">#config</span>
context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'i386'</span>)
context.log_level = <span class="hljs-string">'debug'</span>

FILE_NAME = <span class="hljs-string">"./pseudo.py"</span>

<span class="hljs-comment">#"""</span>
HOST = <span class="hljs-string">"witches-symmetric-exam.seccon.games"</span>
PORT = <span class="hljs-number">8080</span>
<span class="hljs-string">"""
HOST = "localhost"
PORT = 7777
#"""</span>

<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sys.argv[<span class="hljs-number">1</span>] == <span class="hljs-string">'r'</span>:
    conn = remote(HOST, PORT)
<span class="hljs-keyword">else</span>:
    conn = process([<span class="hljs-string">"python3"</span>, FILE_NAME])


<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_oracle</span>(<span class="hljs-params">payload</span>):
    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(payload) % <span class="hljs-number">16</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &gt;= <span class="hljs-number">32</span>

    _payload = payload.<span class="hljs-built_in">hex</span>()
    _payload.zfill(<span class="hljs-built_in">len</span>(payload) * <span class="hljs-number">2</span>)
    conn.sendlineafter(<span class="hljs-string">b': '</span>, _payload.encode())
    resp = conn.recvline()
    <span class="hljs-keyword">if</span> <span class="hljs-string">b'ofb error'</span> <span class="hljs-keyword">in</span> resp:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

<span class="hljs-comment"># padding oracle attack</span>
<span class="hljs-comment"># return palintext of c[-16:]</span>
<span class="hljs-comment"># (note: c includes IV)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_ofb</span>(<span class="hljs-params">c</span>):
    <span class="hljs-comment"># in aes-ofb, if IV is the same, then m[-16:] ^ c[-16:] = const.</span>
    <span class="hljs-comment"># "stack" stores this constant value</span>
    stack = []
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
            <span class="hljs-comment"># change last 16 bytes (i.e., last block) into `\x00...\x00` + i + KNOWN_BYTES</span>
            <span class="hljs-comment"># KNOW_BYTES is computed based on "stack" so that the padding is appropriate</span>
            payload = c[:-<span class="hljs-number">16</span>]
            payload += <span class="hljs-string">b'\x00'</span> * (<span class="hljs-number">15</span> - <span class="hljs-built_in">len</span>(stack))
            payload += long_to_bytes(i)
            payload += <span class="hljs-string">b''</span>.join([long_to_bytes(_ ^ (<span class="hljs-built_in">len</span>(stack) + <span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> stack])    <span class="hljs-comment"># KNOW_BYTES</span>
            <span class="hljs-keyword">if</span> send_oracle(payload):
                stack = [i ^ (<span class="hljs-built_in">len</span>(stack) + <span class="hljs-number">1</span>)] + stack
                <span class="hljs-keyword">break</span>
    
    <span class="hljs-comment"># return (const.) ^ c[-16:]</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">b''</span>.join([long_to_bytes(i ^ j) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(stack, c[-<span class="hljs-number">16</span>:])])


c = <span class="hljs-built_in">int</span>(conn.recvline().split(<span class="hljs-string">b': '</span>)[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)
c = long_to_bytes(c)

c_2 = unpad(decrypt_ofb(c), <span class="hljs-number">16</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] c_2 analyze DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)

c_1 = decrypt_ofb(c[:<span class="hljs-number">64</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] c_1 analyze DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)

nonce = decrypt_ofb(c[:<span class="hljs-number">48</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] nonce analyze DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)
<span class="hljs-comment">#tag = decrypt_ofb(c[:32])</span>

<span class="hljs-comment"># hash_subkey, i.e., E_k(0^128)</span>
hash_subkey = decrypt_ofb(<span class="hljs-string">b'\x00'</span> * <span class="hljs-number">32</span>)    
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] hash_subkey calculate DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)

local = AES.new(os.urandom(<span class="hljs-number">16</span>), AES.MODE_GCM, nonce=nonce)

<span class="hljs-comment"># j0</span>
ctr_0 = local.calculate_target_j0(hash_subkey)

ctr_1 = long_to_bytes(bytes_to_long(ctr_0) + <span class="hljs-number">1</span>)
ctr_2 = long_to_bytes(bytes_to_long(ctr_0) + <span class="hljs-number">2</span>)

<span class="hljs-comment"># E_k(ctr_1) = m_1 ^ c_1</span>
<span class="hljs-comment"># E_k(ctr_2) = m_2 ^ c_2</span>
m_1 = xor(decrypt_ofb(ctr_1 + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>), c_1)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] secret_spell[:16] analyze DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)

m_2 = xor(decrypt_ofb(ctr_2 + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)[:<span class="hljs-number">8</span>], c_2)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] secret_spell[16:] analyze DONE'</span>)

secret_spell = m_1 + m_2
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'secret_spell: <span class="hljs-subst">{secret_spell}</span>'</span>)
<span class="hljs-comment"># decrypt_all!!277260221!!</span>
</div></div></code></pre><h3 id="GCM-Analysis-Part-2" data-id="GCM-Analysis-Part-2"><a class="anchor hidden-xs" href="#GCM-Analysis-Part-2" title="GCM-Analysis-Part-2"><span class="octicon octicon-link"></span></a><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5135">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5136">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5137">M</span></span></span><script type="math/tex" id="MathJax-Element-520">GCM</script></span><span> Analysis Part 2.</span></h3><p><span>Next, forge ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5138"><span class="MJXp-msubsup" id="MJXp-Span-5139"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5140" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-5141" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5142">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5143">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5144">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5145">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5146">e</span></span></span></span></span><script type="math/tex" id="MathJax-Element-521">c_{forge}</script></span><span> for plaintext </span><code>give me key</code><span> (11 bytes).</span></p><p><span>Unlike the previous example, plaintext is one block, so the following diagram is used:</span></p><p><span>But as in Part 1, since the </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5147"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5148">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5149">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5150">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5151">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5152">e</span></span></span><script type="math/tex" id="MathJax-Element-522">nonce</script></span><span> is known, the values of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5153"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5154">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5155">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5156">r</span><span class="MJXp-mtext" id="MJXp-Span-5157">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5158">0</span><span class="MJXp-mo" id="MJXp-Span-5159" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5160">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5161">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5162">r</span><span class="MJXp-mtext" id="MJXp-Span-5163">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5164">1</span></span></span><script type="math/tex" id="MathJax-Element-523">Ctr \ 0, Ctr \ 1</script></span><span> and </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5165"><span class="MJXp-msubsup" id="MJXp-Span-5166"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5167" style="margin-right: 0.05em;">c</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5168" style="vertical-align: -0.4em;">1</span></span></span></span><script type="math/tex" id="MathJax-Element-524">c_1</script></span><span> are known.</span></p><p><img src="https://i.imgur.com/LE6pSgJ.png" alt="" loading="lazy"></p><p><span>How do we forge </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5170">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5171">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5172">g</span></span></span><script type="math/tex" id="MathJax-Element-525">tag</script></span><span>？</span></p><p><span>As in Part 1, we will analyze </span><code>Crypto/Cipher/_mode_gcm.py</code><span> to clarify how </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5174">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5175">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5176">g</span></span></span><script type="math/tex" id="MathJax-Element-526">tag</script></span><span> is generated.</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L525~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt_and_digest</span>(<span class="hljs-params">self, plaintext, output=<span class="hljs-literal">None</span></span>):
        ...

        <span class="hljs-keyword">return</span> self.encrypt(plaintext, output=output), self.digest()
</code></pre><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L434~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">digest</span>(<span class="hljs-params">self</span>):
        ...

        <span class="hljs-keyword">return</span> self._compute_mac()
</code></pre><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L452~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_compute_mac</span>(<span class="hljs-params">self</span>):
        ...
        <span class="hljs-comment"># Step 5 in NIST SP 800-38D, Algorithm 4 - Compute S</span>
        self._pad_cache_and_update()
        self._update(long_to_bytes(<span class="hljs-number">8</span> * self._auth_len, <span class="hljs-number">8</span>))
        self._update(long_to_bytes(<span class="hljs-number">8</span> * self._msg_len, <span class="hljs-number">8</span>))
        s_tag = self._signer.digest()

        <span class="hljs-comment"># Step 6 - Compute T</span>
        self._tag = self._tag_cipher.encrypt(s_tag)[:self._mac_len]

        <span class="hljs-keyword">return</span> self._tag
</code></pre><p><span>So, what is </span><code>self._tag_cipher</code><span> in Step 6? The answer is as follows:</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L250~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, factory, key, nonce, mac_len, cipher_params, ghash_c</span>):
        ...
        <span class="hljs-comment"># Step 6 - Prepare GCTR cipher for GMAC</span>
        self._tag_cipher = factory.new(key,
                                       self._factory.MODE_CTR,
                                       initial_value=j0,
                                       nonce=<span class="hljs-string">b""</span>,
                                       **cipher_params)
</code></pre><p><span>Therefore, </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5177"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5178">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5179">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5180">g</span></span></span><script type="math/tex" id="MathJax-Element-527">tag</script></span><span> is the result of encrypting </span><code>s_tag</code><span> using </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5182">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5183">T</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5184">R</span></span></span><script type="math/tex" id="MathJax-Element-528">CTR</script></span><span> with IV=</span><code>j0</code><span>.</span><br>
<span>And </span><code>j0</code><span> is equal to </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5185"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5186">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5187">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5188">r</span><span class="MJXp-mtext" id="MJXp-Span-5189">&nbsp;</span><span class="MJXp-mn" id="MJXp-Span-5190">0</span></span></span><script type="math/tex" id="MathJax-Element-529">Ctr\ 0</script></span><span>, so </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5191"><span class="MJXp-msubsup" id="MJXp-Span-5192"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5193" style="margin-right: 0.05em;">E</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-5194" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mo" id="MJXp-Span-5195" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5196">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5197">t</span><span class="MJXp-msubsup" id="MJXp-Span-5198"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5199" style="margin-right: 0.05em;">r</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5200" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-5201" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-5202" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5203">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5204">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5205">g</span><span class="MJXp-mtext" id="MJXp-Span-5206">&nbsp;</span><span class="MJXp-mo" id="MJXp-Span-5207" style="margin-left: 0.267em; margin-right: 0.267em;">⊕</span></span></span><script type="math/tex" id="MathJax-Element-530">E_k(Ctr_0) = tag \ \oplus</script></span><span> </span><code>s_tag</code><span>.</span></p><p><span>This means…</span></p><p><img src="https://i.imgur.com/NWNzjIw.png" alt="" loading="lazy"></p><p><span>OK! Now we know that we can call the result of </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5208"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5209">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5210">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5211">l</span><span class="MJXp-msubsup" id="MJXp-Span-5212"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5213" style="margin-right: 0.05em;">t</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-5214" style="vertical-align: -0.4em;">H</span></span></span></span><script type="math/tex" id="MathJax-Element-531">mult_H</script></span><span> (which I didn’t explain in detail) with </span><code>self._signer.digest()</code><span>!</span></p><p><span>Next, let’s analyze </span><code>self._signer</code><span>.</span></p><p><span>The definition of </span><code>self._signer</code><span> is:</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L248~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, factory, key, nonce, mac_len, cipher_params, ghash_c</span>):

        <span class="hljs-comment"># Step 5 - Bootstrat GHASH</span>
        self._signer = _GHASH(hash_subkey, ghash_c)
</code></pre><p><span>and only the following </span><code>_update</code><span> function is related to </span><code>self._signer</code><span>:</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L301~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_update</span>(<span class="hljs-params">self, data</span>):
        <span class="hljs-keyword">assert</span>(<span class="hljs-built_in">len</span>(self._cache) &lt; <span class="hljs-number">16</span>)

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self._cache) &gt; <span class="hljs-number">0</span>:
            filler = <span class="hljs-built_in">min</span>(<span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(self._cache), <span class="hljs-built_in">len</span>(data))
            self._cache += _copy_bytes(<span class="hljs-literal">None</span>, filler, data)
            data = data[filler:]

            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self._cache) &lt; <span class="hljs-number">16</span>:
                <span class="hljs-keyword">return</span>

            <span class="hljs-comment"># The cache is exactly one block</span>
            self._signer.update(self._cache)
            self._cache = <span class="hljs-string">b""</span>

        update_len = <span class="hljs-built_in">len</span>(data) // <span class="hljs-number">16</span> * <span class="hljs-number">16</span>
        self._cache = _copy_bytes(update_len, <span class="hljs-literal">None</span>, data)
        <span class="hljs-keyword">if</span> update_len &gt; <span class="hljs-number">0</span>:
            self._signer.update(data[:update_len])    <span class="hljs-comment"># not called in this challenge</span>
</code></pre><p><span>Note that if the input is less than 16 bytes, such as </span><code>give me key</code><span> in this challenge, the latter half of </span><code>self._signer.update(...)</code><span> is not called.</span><br>
<span>This can be easily found by debugging using </span><code>print(...)</code><span>.</span></p><p><span>Let’s examine the values before and after the </span><code>update</code><span>.</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L301~</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_update</span>(<span class="hljs-params">self, data</span>):
        <span class="hljs-keyword">assert</span>(<span class="hljs-built_in">len</span>(self._cache) &lt; <span class="hljs-number">16</span>)

        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self._cache) &gt; <span class="hljs-number">0</span>:
            filler = <span class="hljs-built_in">min</span>(<span class="hljs-number">16</span> - <span class="hljs-built_in">len</span>(self._cache), <span class="hljs-built_in">len</span>(data))
            self._cache += _copy_bytes(<span class="hljs-literal">None</span>, filler, data)
            data = data[filler:]

            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self._cache) &lt; <span class="hljs-number">16</span>:
                <span class="hljs-keyword">return</span>

            <span class="hljs-comment"># The cache is exactly one block</span>
            
            <span class="hljs-comment"># add for debugging</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'[*] signer update called'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[*] before: <span class="hljs-subst">{self._signer.digest().<span class="hljs-built_in">hex</span>()}</span>'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[*] input : <span class="hljs-subst">{self._cache.<span class="hljs-built_in">hex</span>()}</span>'</span>)
            
            self._signer.update(self._cache)
            
            <span class="hljs-comment"># add for debugging</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f'[*] after : <span class="hljs-subst">{self._signer.digest().<span class="hljs-built_in">hex</span>()}</span>'</span>)
            
            self._cache = <span class="hljs-string">b""</span>

        update_len = <span class="hljs-built_in">len</span>(data) // <span class="hljs-number">16</span> * <span class="hljs-number">16</span>
        self._cache = _copy_bytes(update_len, <span class="hljs-literal">None</span>, data)
        <span class="hljs-keyword">if</span> update_len &gt; <span class="hljs-number">0</span>:
            self._signer.update(data[:update_len])
</code></pre><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># sample.py</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES

key = os.urandom(<span class="hljs-number">16</span>)
nonce = os.urandom(<span class="hljs-number">16</span>)
message = <span class="hljs-string">b'give me key'</span>

target = AES.new(key, AES.MODE_GCM, nonce=nonce)
ciphertext, tag = target.encrypt_and_digest(message)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f'ciphertext: <span class="hljs-subst">{ciphertext}</span>'</span>)

<span class="hljs-comment"># [*] signer update called</span>
<span class="hljs-comment"># [*] before: 00000000000000000000000000000000</span>
<span class="hljs-comment"># [*] input : 0a2534f2b0f2e8f96b49bf0000000000</span>
<span class="hljs-comment"># [*] after : 4d963b3b80e3eafa10ba9583686a8211</span>
<span class="hljs-comment"># [*] signer update called</span>
<span class="hljs-comment"># [*] before: 4d963b3b80e3eafa10ba9583686a8211</span>
<span class="hljs-comment"># [*] input : 00000000000000000000000000000058</span>
<span class="hljs-comment"># [*] after : 4564d079916cfb62d386f187bc644eeb</span>
<span class="hljs-comment"># ciphertext: 0a2534f2b0f2e8f96b49bf</span>
</div></div></code></pre><p><span>We totally get how </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5215"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5216">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5217">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5218">M</span></span></span><script type="math/tex" id="MathJax-Element-532">GCM</script></span><span> works! We did it!</span></p><p><img src="https://i.imgur.com/AeKvdLP.png" alt="" loading="lazy"></p><p><span>It is also consistent with the fact that it is zero padding.</span><br>
<span>And the length of the message(11 bytes </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5219"><span class="MJXp-mo" id="MJXp-Span-5220" style="margin-left: 0.333em; margin-right: 0.333em;">=</span></span></span><script type="math/tex" id="MathJax-Element-533">=</script></span><span> 88 bits) and </span><code>0x58</code><span> match!</span></p><p><span>Now it is time to embed the function that calculates the challenge server’s </span><code>s_tag</code><span> in </span><code>Crypto/Cipher/_mode_gcm.py</code><span>.</span></p><pre><code class="python hljs"><span class="hljs-comment"># Crypto/Cipher/_mode_gcm.py#L261~</span>
    
    <span class="hljs-comment"># add your own function</span>
    <span class="hljs-comment"># this is only valid for this challenge</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_target_s_tag</span>(<span class="hljs-params">self, hash_subkey, cipher</span>):
        _signer = _GHASH(hash_subkey, self._ghash_c)
        _signer.update(cipher + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">5</span>)
        _signer.update(<span class="hljs-string">b'\x00'</span> * <span class="hljs-number">15</span> + <span class="hljs-string">b'\x58'</span>)
        <span class="hljs-keyword">return</span> _signer.digest()
</code></pre><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code">nonce = ...

message = <span class="hljs-string">b'give me key'</span>

local = AES.new(os.urandom(<span class="hljs-number">16</span>), AES.MODE_GCM, nonce=nonce)
hash_subkey = decrypt_ofb(<span class="hljs-string">b'\x00'</span> * <span class="hljs-number">32</span>)

<span class="hljs-comment"># j0</span>
ctr_0 = local.calculate_target_j0(hash_subkey)

<span class="hljs-comment"># E_k(ctr_1) = message ^ c_forgery</span>
ctr_1 = long_to_bytes(bytes_to_long(ctr_0) + <span class="hljs-number">1</span>)
c_forgery = xor(decrypt_ofb(ctr_1 + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)[:<span class="hljs-number">11</span>], message)

<span class="hljs-comment"># forge s_tag</span>
s_tag = local.calculate_target_s_tag(hash_subkey, c_forgery)

<span class="hljs-comment"># compute final tag using CTR</span>
tag_forgery = xor(decrypt_ofb(ctr_0 + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>), s_tag)
</div></div></code></pre><p><span>This is the end of forgery within </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5222">G</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5223">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5224">M</span></span></span><script type="math/tex" id="MathJax-Element-534">GCM</script></span><span>.</span><br>
<span>Now we can forge the final ciphertext </span><span class="mathjax raw"><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5225"><span class="MJXp-msubsup" id="MJXp-Span-5226"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5227" style="margin-right: 0.05em;">c</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-5228" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5229">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5230">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5231">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5232">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5233">e</span></span></span></span></span><script type="math/tex" id="MathJax-Element-535">c_{forge}</script></span><span> by setting IV randomly!</span></p><h3 id="Solver-Part-2" data-id="Solver-Part-2"><a class="anchor hidden-xs" href="#Solver-Part-2" title="Solver-Part-2"><span class="octicon octicon-link"></span></a><span>Solver Part 2.</span></h3><pre><code class="python hljs"><div class="wrapper"><div class="gutter linenumber"><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span></div><div class="code"><span class="hljs-comment"># solver_part2.py</span>
<span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES
<span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad

<span class="hljs-comment">#config</span>
context(os=<span class="hljs-string">'linux'</span>, arch=<span class="hljs-string">'i386'</span>)
context.log_level = <span class="hljs-string">'debug'</span>

FILE_NAME = <span class="hljs-string">"./pseudo.py"</span>

<span class="hljs-comment">#"""</span>
HOST = <span class="hljs-string">"witches-symmetric-exam.seccon.games"</span>
PORT = <span class="hljs-number">8080</span>
<span class="hljs-string">"""
HOST = "localhost"
PORT = 7777
#"""</span>

<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sys.argv[<span class="hljs-number">1</span>] == <span class="hljs-string">'r'</span>:
    conn = remote(HOST, PORT)
<span class="hljs-keyword">else</span>:
    conn = process([<span class="hljs-string">"python3"</span>, FILE_NAME])


<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_oracle</span>(<span class="hljs-params">payload</span>):
    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(payload) % <span class="hljs-number">16</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(payload) &gt;= <span class="hljs-number">32</span>

    _payload = payload.<span class="hljs-built_in">hex</span>()
    _payload.zfill(<span class="hljs-built_in">len</span>(payload) * <span class="hljs-number">2</span>)
    conn.sendlineafter(<span class="hljs-string">b': '</span>, _payload.encode())
    resp = conn.recvline()
    <span class="hljs-keyword">if</span> <span class="hljs-string">b'ofb error'</span> <span class="hljs-keyword">in</span> resp:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

<span class="hljs-comment"># padding oracle attack</span>
<span class="hljs-comment"># return palintext of c[-16:]</span>
<span class="hljs-comment"># (note: c includes IV)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_ofb</span>(<span class="hljs-params">c</span>):
    <span class="hljs-comment"># in aes-ofb, if IV is the same, then m[-16:] ^ c[-16:] = const.</span>
    <span class="hljs-comment"># "stack" stores this constant value</span>
    stack = []
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):
            <span class="hljs-comment"># change last 16 bytes (i.e., last block) into `\x00...\x00` + i + KNOWN_BYTES</span>
            <span class="hljs-comment"># KNOW_BYTES is computed based on "stack" so that the padding is appropriate</span>
            payload = c[:-<span class="hljs-number">16</span>]
            payload += <span class="hljs-string">b'\x00'</span> * (<span class="hljs-number">15</span> - <span class="hljs-built_in">len</span>(stack))
            payload += long_to_bytes(i)
            payload += <span class="hljs-string">b''</span>.join([long_to_bytes(_ ^ (<span class="hljs-built_in">len</span>(stack) + <span class="hljs-number">1</span>)) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> stack])    <span class="hljs-comment"># KNOW_BYTES</span>
            <span class="hljs-keyword">if</span> send_oracle(payload):
                stack = [i ^ (<span class="hljs-built_in">len</span>(stack) + <span class="hljs-number">1</span>)] + stack
                <span class="hljs-keyword">break</span>
    
    <span class="hljs-comment"># return (const.) ^ c[-16:]</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">b''</span>.join([long_to_bytes(i ^ j) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(stack, c[-<span class="hljs-number">16</span>:])])


c = <span class="hljs-built_in">int</span>(conn.recvline().split(<span class="hljs-string">b': '</span>)[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>)
c = long_to_bytes(c)

<span class="hljs-comment">#c_2 = unpad(decrypt_ofb(c), 16)</span>
<span class="hljs-comment">#c_1 = decrypt_ofb(c[:64])</span>
nonce = decrypt_ofb(c[:<span class="hljs-number">48</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] nonce analyze DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)
<span class="hljs-comment">#tag = decrypt_ofb(c[:32])</span>

message = <span class="hljs-string">b'give me key'</span>

local = AES.new(os.urandom(<span class="hljs-number">16</span>), AES.MODE_GCM, nonce=nonce)

<span class="hljs-comment"># hash_subkey, i.e., E_k(0^128)</span>
hash_subkey = decrypt_ofb(<span class="hljs-string">b'\x00'</span> * <span class="hljs-number">32</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] hash_subkey calculate DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)

<span class="hljs-comment"># j0</span>
ctr_0 = local.calculate_target_j0(hash_subkey)

<span class="hljs-comment"># E_k(ctr_1)[:11] = c ^ b'give me key'</span>
ctr_1 = long_to_bytes(bytes_to_long(ctr_0) + <span class="hljs-number">1</span>)
c_forgery = xor(decrypt_ofb(ctr_1 + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)[:<span class="hljs-number">11</span>], message)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] c forgery DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)

s_tag = local.calculate_target_s_tag(hash_subkey, c_forgery)
<span class="hljs-comment"># tag = E_k(ctr_0) ^ s_tag</span>
ctr_0_enc = decrypt_ofb(ctr_0 + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)
tag_forgery = xor(ctr_0_enc, s_tag)
<span class="hljs-built_in">print</span>(<span class="hljs-string">'[+] tag forgery DONE'</span>)
time.sleep(<span class="hljs-number">3</span>)


ofb_input = pad(tag_forgery + nonce + c_forgery, <span class="hljs-number">16</span>)

<span class="hljs-comment"># to make it faster...</span>
<span class="hljs-comment"># IV_forgery = os.urandom(16)</span>
IV_forgery = ctr_0
<span class="hljs-comment"># IV_enc = decrypt_ofb(IV_forgery + b'\x00' * 16)</span>
IV_enc = ctr_0_enc
IV_enc_enc = decrypt_ofb(IV_enc + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)
IV_enc_enc_enc = decrypt_ofb(IV_enc_enc + <span class="hljs-string">b'\x00'</span> * <span class="hljs-number">16</span>)

final_payload = (IV_forgery + xor(IV_enc + IV_enc_enc + IV_enc_enc_enc, ofb_input)).<span class="hljs-built_in">hex</span>().zfill(<span class="hljs-number">128</span>)
conn.sendlineafter(<span class="hljs-string">b': '</span>, final_payload.encode())


secret_spell = <span class="hljs-string">b'decrypt_all!!277260221!!'</span>
conn.sendlineafter(<span class="hljs-string">b':'</span>, secret_spell)
<span class="hljs-built_in">print</span>(conn.recvline())
<span class="hljs-comment"># SECCON{you_solved_this!?I_g1ve_y0u_symmetr1c_cipher_mage_certificate}</span>
conn.close()
</div></div></code></pre></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#SECCON-CTF-2022-Writeup-crypto" title="SECCON CTF 2022 Writeup (crypto)">SECCON CTF 2022 Writeup (crypto)</a><ul class="nav">
<li><a href="#pqpq-96-pts-112-solved" title="pqpq (96 pts, 112 solved)">pqpq (96 pts, 112 solved)</a><ul class="nav">
<li><a href="#Overview" title="Overview">Overview</a></li>
<li><a href="#Prime-Factorization" title="Prime Factorization">Prime Factorization</a></li>
<li><a href="#Square-Root-Modulo-N" title="Square Root Modulo \(N\)">Square Root Modulo \(N\)</a></li>
<li><a href="#Solver" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#BBB-136-pts-50-solved" title="BBB (136 pts, 50 solved)">BBB (136 pts, 50 solved)</a><ul class="nav">
<li><a href="#Overview1" title="Overview">Overview</a></li>
<li><a href="#Ignore-k_i" title="Ignore \(k_i\)">Ignore \(k_i\)</a></li>
<li><a href="#Fix-E_i--11-is-it-OK" title="Fix \(E_i = 11\), is it OK?">Fix \(E_i = 11\), is it OK?</a></li>
<li><a href="#Computation-of-X_i" title="Computation of \(X_i\)">Computation of \(X_i\)</a></li>
<li><a href="#Solver1" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#this_is_not_lsb-162-pts-34-solved" title="this_is_not_lsb (162 pts. 34 solved)">this_is_not_lsb (162 pts. 34 solved)</a><ul class="nav">
<li><a href="#Overview2" title="Overview">Overview</a></li>
<li><a href="#RSA-homomorphism" title="RSA homomorphism">RSA homomorphism</a></li>
<li><a href="#Find-One-Example-where-the-Oracle-Returns-True" title="Find One Example where the Oracle Returns True">Find One Example where the Oracle Returns True</a></li>
<li><a href="#Refine-the-Range-of-m" title="Refine the Range of \(m\)">Refine the Range of \(m\)</a></li>
<li><a href="#Solver2" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#insufficient-164-pts-33-solved" title="insufficient (164 pts, 33 solved)">insufficient (164 pts, 33 solved)</a><ul class="nav">
<li><a href="#Overview3" title="Overview">Overview</a></li>
<li><a href="#Hidden-Number-Problem" title="Hidden Number Problem">Hidden Number Problem</a></li>
<li><a href="#Construction-of-Lattice" title="Construction of Lattice">Construction of Lattice</a></li>
<li><a href="#Find-a_1-a_2-a_3-b_1-b_2-b_3" title="Find \(a_1, a_2, a_3, b_1, b_2, b_3\)">Find \(a_1, a_2, a_3, b_1, b_2, b_3\)</a></li>
<li><a href="#Find-c-and-s" title="Find \(c\) and \(s\)">Find \(c\) and \(s\)</a></li>
<li><a href="#Solver3" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#witches_symmetric_exam-197-pts-22-solved" title="witches_symmetric_exam (197 pts, 22 solved)">witches_symmetric_exam (197 pts, 22 solved)</a><ul class="nav">
<li><a href="#Overview4" title="Overview">Overview</a></li>
<li><a href="#Padding-Oracle-Attack" title="Padding Oracle Attack">Padding Oracle Attack</a></li>
<li><a href="#GCM-Analysis-Part-1" title="\(GCM\) Analysis Part 1.">\(GCM\) Analysis Part 1.</a></li>
<li><a href="#Solver-Part-1" title="Solver Part 1.">Solver Part 1.</a></li>
<li><a href="#GCM-Analysis-Part-2" title="\(GCM\) Analysis Part 2.">\(GCM\) Analysis Part 2.</a></li>
<li><a href="#Solver-Part-2" title="Solver Part 2.">Solver Part 2.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">全部見る</a><a class="back-to-top" href="#">トップへ戻る</a><a class="go-to-bottom" href="#">底へ移る</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#SECCON-CTF-2022-Writeup-crypto" title="SECCON CTF 2022 Writeup (crypto)">SECCON CTF 2022 Writeup (crypto)</a><ul class="nav">
<li><a href="#pqpq-96-pts-112-solved" title="pqpq (96 pts, 112 solved)">pqpq (96 pts, 112 solved)</a><ul class="nav">
<li><a href="#Overview" title="Overview">Overview</a></li>
<li><a href="#Prime-Factorization" title="Prime Factorization">Prime Factorization</a></li>
<li><a href="#Square-Root-Modulo-N" title="Square Root Modulo \(N\)">Square Root Modulo \(N\)</a></li>
<li><a href="#Solver" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#BBB-136-pts-50-solved" title="BBB (136 pts, 50 solved)">BBB (136 pts, 50 solved)</a><ul class="nav">
<li><a href="#Overview1" title="Overview">Overview</a></li>
<li><a href="#Ignore-k_i" title="Ignore \(k_i\)">Ignore \(k_i\)</a></li>
<li><a href="#Fix-E_i--11-is-it-OK" title="Fix \(E_i = 11\), is it OK?">Fix \(E_i = 11\), is it OK?</a></li>
<li><a href="#Computation-of-X_i" title="Computation of \(X_i\)">Computation of \(X_i\)</a></li>
<li><a href="#Solver1" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#this_is_not_lsb-162-pts-34-solved" title="this_is_not_lsb (162 pts. 34 solved)">this_is_not_lsb (162 pts. 34 solved)</a><ul class="nav">
<li><a href="#Overview2" title="Overview">Overview</a></li>
<li><a href="#RSA-homomorphism" title="RSA homomorphism">RSA homomorphism</a></li>
<li><a href="#Find-One-Example-where-the-Oracle-Returns-True" title="Find One Example where the Oracle Returns True">Find One Example where the Oracle Returns True</a></li>
<li><a href="#Refine-the-Range-of-m" title="Refine the Range of \(m\)">Refine the Range of \(m\)</a></li>
<li><a href="#Solver2" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#insufficient-164-pts-33-solved" title="insufficient (164 pts, 33 solved)">insufficient (164 pts, 33 solved)</a><ul class="nav">
<li><a href="#Overview3" title="Overview">Overview</a></li>
<li><a href="#Hidden-Number-Problem" title="Hidden Number Problem">Hidden Number Problem</a></li>
<li><a href="#Construction-of-Lattice" title="Construction of Lattice">Construction of Lattice</a></li>
<li><a href="#Find-a_1-a_2-a_3-b_1-b_2-b_3" title="Find \(a_1, a_2, a_3, b_1, b_2, b_3\)">Find \(a_1, a_2, a_3, b_1, b_2, b_3\)</a></li>
<li><a href="#Find-c-and-s" title="Find \(c\) and \(s\)">Find \(c\) and \(s\)</a></li>
<li><a href="#Solver3" title="Solver">Solver</a></li>
</ul>
</li>
<li><a href="#witches_symmetric_exam-197-pts-22-solved" title="witches_symmetric_exam (197 pts, 22 solved)">witches_symmetric_exam (197 pts, 22 solved)</a><ul class="nav">
<li><a href="#Overview4" title="Overview">Overview</a></li>
<li><a href="#Padding-Oracle-Attack" title="Padding Oracle Attack">Padding Oracle Attack</a></li>
<li><a href="#GCM-Analysis-Part-1" title="\(GCM\) Analysis Part 1.">\(GCM\) Analysis Part 1.</a></li>
<li><a href="#Solver-Part-1" title="Solver Part 1.">Solver Part 1.</a></li>
<li><a href="#GCM-Analysis-Part-2" title="\(GCM\) Analysis Part 2.">\(GCM\) Analysis Part 2.</a></li>
<li><a href="#Solver-Part-2" title="Solver Part 2.">Solver Part 2.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">全部見る</a><a class="back-to-top" href="#">トップへ戻る</a><a class="go-to-bottom" href="#">底へ移る</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
